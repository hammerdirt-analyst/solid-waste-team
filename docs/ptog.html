

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. Estimating values &#8212; Progress towards a goal</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ptog';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="1. Monitoring beach litter with future engineers" href="summary_2015_2021.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="titlepage.html">
  
  
  
  
  
    <p class="title logo__title">Progress towards a goal</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="summary_2015_2021.html">1. Monitoring beach litter with future engineers</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Estimating values</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/swe" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/swe/issues/new?title=Issue%20on%20page%20%2Fptog.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Estimating values</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#research-questions">2.1. Research questions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-applications">2.1.1. Practical applications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-and-definitions">2.2. Methods and definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold">2.2.1. threshold</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency">2.2.2. frequency</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#land-use">2.2.3. land-use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#probability">2.2.4. probability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-tables">2.2.5. Inference tables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#local-environmental-conditions">2.2.6. local environmental conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-landuse-attributes">2.2.6.1. distribution of landuse attributes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-of-land-use-attributes">2.2.6.2. correlation of land use attributes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#codes-of-interest">2.2.7. Codes of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-one-november-2015-november-2016">2.3. Sampling period one: November 2015 - November 2016</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chance-of-exceeding-threshold-lake">2.3.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chance-of-exceeding-threshold-city">2.3.2. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-two-april-2017-may-2018">2.4. Sampling period two: April 2017 - May 2018</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.4.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.4.2. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-three-april-2020-may-2021">2.5. Sampling period three: April 2020 - May 2021</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.5.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.5.2. Chance of exceeding threshold: city</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.5.3. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-after-may-2021">2.6. Samples after May 2021</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results-for-saint-sulpice">2.6.1. Expected results for Saint Sulpice</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-lake">2.6.1.1. The probability of the observed results at Saint Sulpice given the informed posterior from lake</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-saint-sulpice">2.6.1.2. The probability of the observed results at Saint Sulpice given the informed posterior from Saint Sulpice</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plastock">2.6.2. Plastock</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-values-and-predictions-plastock">2.6.2.1. Expected values and predictions plastock</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mix-of-objects-of-total">2.6.2.2. Mix of objects, % of total</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="estimating-values">
<h1><span class="section-number">2. </span>Estimating values<a class="headerlink" href="#estimating-values" title="Permalink to this headline">#</a></h1>
<p><strong>This is in draft. The methods are correct but the narrative, descriptions and references are being defined. The language needs to be standardized to english, there are several data sources in multiple languages (this is Switzerland)</strong></p>
<p>The data gathered by the SWE team in 2020 was included in the federal report on shoreline litter density. Since the puplication of IQAASL in December 2021 there has been addtional data collection events on Lac Léman</p>
<ol class="arabic simple">
<li><p>SWE team</p></li>
<li><p>Association for the Sauvegarde du Léman completed 100 beach litter surveys in 2022</p></li>
</ol>
<p><strong>Six year sampling period</strong></p>
<p>The timing of these samples, seven years after the first samples were recorded, could be interpreted as the begining of a new six year sampling period that started in January 2022. The Joint Research Center (JRC) at the EU suggest a six year sampling period with preferably ~ 40 surveys in that time, for each beach that is being monitored. If these conditions are met a baseline value can be established for the location in question. The baseline value, using this method is the median value of the surveys for the time period.</p>
<p>There are over 250 samples in the initial six year period, from 30+ locations on the lake. There are no locations that have 40 surveys, therefore the method described previously would not be appropriate for any single location, but it is more than enough for the lake. Recall that we previously discussed the following:</p>
<ol class="arabic simple">
<li><p>independence of samples: difference among sampling groups</p></li>
<li><p>land use: correlation of survey results to topographic features</p></li>
</ol>
<div class="section" id="research-questions">
<h2><span class="section-number">2.1. </span>Research questions<a class="headerlink" href="#research-questions" title="Permalink to this headline">#</a></h2>
<p><strong>For the lake and Saint Sulpice:</strong></p>
<ol class="arabic simple">
<li><p>Given the data from 2022, Is there an increase, decrease or no change in the expected survey results given the consolidated results from 2015 - 2021?</p></li>
<li><p>Is the mix of identified objects different between 2022 and 2015 - 2021?</p></li>
<li><p>Given the median value for the objects of interest in 2021, what is the chance that a survey in 2022 will exceed this value?</p></li>
<li><p>How do the results from 2022 change the expected survey results going forward?</p></li>
</ol>
<div class="section" id="practical-applications">
<h3><span class="section-number">2.1.1. </span>Practical applications<a class="headerlink" href="#practical-applications" title="Permalink to this headline">#</a></h3>
<p>Investments have been made to either prevent or remove litter from the public space. The investments are made with the intention of reducing litter in the environment. The answers to the research questions should help evaluate the return on investment (ROI) from previous projects and provide insights for projects going forward.</p>
<ol class="arabic simple">
<li><p><strong>Did the investment result in a net decline in litter?</strong></p></li>
<li><p><strong>What objects were particularly effected?</strong></p></li>
<li><p><strong>How does the municpality compare to the rest of the lake?</strong></p></li>
</ol>
<p>The prior investments were part of a regional action plan that included all municipal and cantonal administrations on the lake. Therefore, municipal results need to be formulated in the context of the canton and the lake.</p>
</div>
</div>
<div class="section" id="methods-and-definitions">
<h2><span class="section-number">2.2. </span>Methods and definitions<a class="headerlink" href="#methods-and-definitions" title="Permalink to this headline">#</a></h2>
<div class="section" id="threshold">
<h3><span class="section-number">2.2.1. </span>threshold<a class="headerlink" href="#threshold" title="Permalink to this headline">#</a></h3>
<p>The threshold of interest is the median survey result for an object given the data from 2015 - 2021</p>
</div>
<div class="section" id="frequency">
<h3><span class="section-number">2.2.2. </span>frequency<a class="headerlink" href="#frequency" title="Permalink to this headline">#</a></h3>
<p>The frequency of exceeding a threshold is the number of times that a threshold was exceeded (k) divided by the number of samples taken (n) or k/n.</p>
</div>
<div class="section" id="land-use">
<h3><span class="section-number">2.2.3. </span>land-use<a class="headerlink" href="#land-use" title="Permalink to this headline">#</a></h3>
<p>The common topographical features within a radius of 1500m from each survey location.</p>
</div>
<div class="section" id="probability">
<h3><span class="section-number">2.2.4. </span>probability<a class="headerlink" href="#probability" title="Permalink to this headline">#</a></h3>
<p>The probability of exceeding the threshhold is conditioned upon when the survey was taken, where the survey is located and the land-use. Recall that k/n can be interpreted as the likelihood (MLE) of the binomial distribution that the threshhold will be exceeded. This ratio, along with the observed k and n of a particular location or group of locations can be combined using a common rule of probability:</p>
<div class="math notranslate nohighlight">
\[p(a|b) = \frac{p(b|a)*p(a)}{p(b)}\]</div>
<p>Substituting the variables from the data:</p>
<div class="math notranslate nohighlight">
\[p(threshhold|landuse) = \frac{p(landuse|threshhold)*p(threshhold)}{p(landuse)}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p(threshhold|landuse)\)</span> = <strong>Posterior:</strong> the probability of exceeding the threshhold given the land use conditions, the question we are trying to answer</p></li>
<li><p><span class="math notranslate nohighlight">\(p(landuse|threshhold)\)</span> = <strong>The likelihood</strong> of exceeding the threshhold for a land-use attribute given <span class="math notranslate nohighlight">\(threshold\)</span>. The n/k for a location from the sampling period of interest. This does not include results from other locations .</p></li>
<li><p><span class="math notranslate nohighlight">\(p(threshhold)\)</span> = The <strong>prior</strong> knowledge. The n/k of all locations with similar landuse conditions to the location of interest.</p></li>
<li><p><span class="math notranslate nohighlight">\(p(landuse)\)</span> = <strong>The total probability</strong>, the probability under all possible land-use conditions and all possible thresholds</p></li>
</ul>
<p>This is read as:</p>
<blockquote>
<div><p>The probability of exceeding the threshold given the land-use conditions is equal to the product of  the probability that the threshold was exceeded for a land-use condition given the proabability of exceeding the threshold <em>times</em> the probability of exceeding the threshhold, <em>divided</em> by the probability of exceeding the threshold under all land-use condtions and all thresholds. (<a class="reference external" href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ theorem</a>) (<a class="reference external" href="https://en.wikipedia.org/wiki/Conditional_probability">conditional proabability</a>)</p>
</div></blockquote>
</div>
<div class="section" id="inference-tables">
<h3><span class="section-number">2.2.5. </span>Inference tables<a class="headerlink" href="#inference-tables" title="Permalink to this headline">#</a></h3>
<p>Point estimates can be calculated using the formula above. This example is 100% inspired by Alan Downeys example in <a class="reference external" href="https://allendowney.github.io/ThinkBayes2/chap02.html">Think Bayes 2</a>. There are two separate hypothesis: <em>h = the threshhold was exceeded</em>, <em>h1 = the threshhold was not exceeded</em>. Total probability is accounted for when the column <em>likelihood*prior</em> is added up and divided through to make the <em>posterior</em> column.</p>
<div class="cell tag_hide-input tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are the land use values for each hex</span>
<span class="c1"># nutuzungsareal and freizeit areal are totaled</span>
<span class="c1"># the surface area of these two use cases gets added</span>
<span class="c1"># to the total of the land cover surface area</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/infrastructure.csv&quot;</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/recreation.csv&quot;</span><span class="p">)</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># rename the columns and total the surface are for each component</span>
<span class="n">dflf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">dflf</span><span class="p">[</span><span class="o">~</span><span class="n">dflf</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dflf_t</span> <span class="o">=</span> <span class="n">dflf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;recreation&quot;</span>
<span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="n">dfln</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">dfln</span><span class="p">[</span><span class="o">~</span><span class="n">dfln</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfln_t</span> <span class="o">=</span> <span class="n">dfln</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;infrastructure&quot;</span>
<span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfln_t</span><span class="p">,</span> <span class="n">dflf_t</span><span class="p">])</span>
<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">rec_inf</span><span class="p">[</span><span class="n">rec_inf</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span>
<span class="n">rec_inf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dflc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/landcover.csv&quot;</span><span class="p">)</span>
<span class="n">dflc</span> <span class="o">=</span> <span class="n">dflc</span><span class="p">[</span><span class="n">dflc</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># sum the unique land cover values for each location</span>
<span class="n">area_of_a_hex</span> <span class="o">=</span> <span class="mi">5845672</span>
<span class="n">xgr</span> <span class="o">=</span> <span class="n">dflc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;OBJVAL&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the sum of all the land cover values for a location</span>
<span class="n">xgrt</span> <span class="o">=</span> <span class="n">xgr</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the amount of surface area that is not accounted for </span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xgrt</span><span class="o">.</span><span class="n">area</span>

<span class="c1"># format data frame to join to the other land cover totals</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;undefined&quot;</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span>
<span class="n">xgrt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add to other totals</span>
<span class="n">dflcx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xgr</span><span class="p">,</span> <span class="n">xgrt</span><span class="p">])</span>


<span class="c1"># remove the value of See from the surface area of a hex.</span>
<span class="c1"># We are considering the magnitude of land use type in relation</span>
<span class="c1"># to the amount of land that is available to be used, not including </span>
<span class="c1"># amount of land that is covered by the lake itself</span>
<span class="c1"># xsee = xgr[xgr.OBJVAL == &quot;See&quot;][[&quot;slug&quot;, &quot;area&quot;]]</span>
<span class="c1"># xsee[&quot;hex minus&quot;] = area_of_a_hex - xsee.area</span>
<span class="c1"># hex_minus = xsee[[&quot;slug&quot;, &quot;hex minus&quot;]].set_index(&quot;slug&quot;, drop=True)</span>
<span class="n">xgr_l</span> <span class="o">=</span> <span class="n">xgr</span><span class="p">[</span><span class="n">xgr</span><span class="o">.</span><span class="n">water</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">xgr_r</span> <span class="o">=</span> <span class="n">xgr</span><span class="p">[</span><span class="n">xgr</span><span class="o">.</span><span class="n">water</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">xgr_r</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span>

<span class="n">xsee</span> <span class="o">=</span> <span class="n">xgr_l</span><span class="p">[</span><span class="n">xgr_l</span><span class="o">.</span><span class="n">OBJVAL</span> <span class="o">==</span> <span class="s2">&quot;See&quot;</span><span class="p">][[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">]]</span>
<span class="n">xsee</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xsee</span><span class="o">.</span><span class="n">area</span>
<span class="n">hex_minus</span> <span class="o">=</span> <span class="n">xsee</span><span class="p">[[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">hex_not_minus</span> <span class="o">=</span> <span class="n">xgr_r</span><span class="p">[[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># hex_not_minus.drop_duplicates(inplace=True)</span>
<span class="n">xsee_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">hex_not_minus</span><span class="p">,</span> <span class="n">hex_minus</span><span class="p">])</span>

<span class="c1"># map the adjusted surface area to to the land use</span>
<span class="c1"># totals and scale the surface column to the adjusted surface area</span>
<span class="n">dflcx</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dflcx</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">xsee_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">])</span>
<span class="c1"># rec_inf[&quot;hex minus&quot;] = rec_inf.slug.apply(lambda x: xsee_all.loc[x, &quot;hex minus&quot;])</span>
<span class="c1"># change column name</span>
<span class="n">dflcx</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">land_cover</span> <span class="o">=</span> <span class="n">dflcx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">land_cover</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">land_cover</span><span class="o">.</span><span class="n">area</span><span class="o">/</span><span class="n">land_cover</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span>

<span class="c1"># remove See from the data frame</span>
<span class="n">land_cover</span> <span class="o">=</span> <span class="n">land_cover</span><span class="p">[</span><span class="n">land_cover</span><span class="o">.</span><span class="n">use</span> <span class="o">!=</span> <span class="s2">&quot;See&quot;</span><span class="p">]</span>

<span class="n">bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0000001</span><span class="p">,</span> <span class="mf">.0499999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.0500000</span><span class="p">,</span> <span class="mf">.0999999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.1000000</span><span class="p">,</span> <span class="mf">.1499999</span><span class="p">),(</span><span class="mf">.1500000</span><span class="p">,</span> <span class="mf">.1999999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.2999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.3000</span><span class="p">,</span> <span class="mf">.3499</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.35</span><span class="p">,</span> <span class="mf">.3999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.4000</span><span class="p">,</span> <span class="mf">.449999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.499999</span><span class="p">),(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.549999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.55</span><span class="p">,</span> <span class="mf">.5999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.6000</span><span class="p">,</span> <span class="mf">.6499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.65</span><span class="p">,</span> <span class="mf">.6999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.7</span><span class="p">,</span> <span class="mf">.7499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.75</span><span class="p">,</span> <span class="mf">.7999</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.8499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.85</span><span class="p">,</span> <span class="mf">.8999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">.9499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="c1"># bin the scaled column</span>
<span class="n">sbins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">land_cover</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbins</span><span class="o">=</span><span class="n">sbins</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>

<span class="n">rbins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">rec_inf</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rbins</span><span class="o">=</span><span class="n">rbins</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>
<span class="n">rec_inf</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rbins</span>

<span class="n">merge_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;magnitude&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]</span>
<span class="n">land_cover</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbins</span>
<span class="n">land_cover</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">merge_df</span> <span class="o">=</span> <span class="n">land_cover</span><span class="p">[</span><span class="n">merge_columns</span><span class="p">]</span>
<span class="n">agg_land_use</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">rec_inf</span><span class="p">,</span> <span class="n">merge_df</span><span class="p">])</span>

<span class="n">dist_ct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/intersect_length.csv&quot;</span><span class="p">)</span>
<span class="n">dist_ct</span> <span class="o">=</span> <span class="n">dist_ct</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span><span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMN&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dist_ct</span><span class="p">[</span><span class="n">dist_ct</span><span class="o">.</span><span class="n">slug</span> <span class="o">==</span> <span class="s2">&quot;mullermatte&quot;</span><span class="p">]</span>

<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/d_to_intersect.csv&quot;</span><span class="p">)</span>

<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">wt_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ct_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;water_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">wn_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="c1"># dist_dt = dist_ct.groupby(&quot;location&quot;, as_index=False).agg({&quot;distance&quot;:&quot;mean&quot;, &quot;length&quot;:&quot;sum&quot;})</span>
<span class="c1"># dist_dt = dist_dt[dist_dt.location.isin(df.location.unique())].copy()</span>
<span class="c1"># dist_dt = pd.melt(dist_dt, id_vars = &quot;location&quot;, value_vars=[&quot;length&quot;, &quot;distance&quot;])</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMN&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="p">[</span><span class="n">dist_dt</span><span class="o">.</span><span class="n">water</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dr</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dnr</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="p">[</span><span class="n">dist_dt</span><span class="o">.</span><span class="n">water</span> <span class="o">!=</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dnr</span><span class="p">,</span> <span class="n">dr</span><span class="p">])</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dist_dt</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMN&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
<span class="n">dist_ct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dist_ct</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;NAMN&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">])</span>

<span class="c1"># river network and disttance to intersection</span>
<span class="n">dist_it_len</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dist_dt</span><span class="p">,</span> <span class="n">dist_ct</span><span class="p">])</span>

<span class="c1"># min max scale</span>
<span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="c1"># bin in groups of 0.05 plus one bin for zero</span>
<span class="n">sbinsr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dist_it_len</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbinsr</span><span class="o">=</span><span class="n">sbinsr</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>
<span class="n">dist_it_len</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbinsr</span>
<span class="n">dist_it_len</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;variable&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dist_it_len</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">strasse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/geodata/streets.csv&quot;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">strasse</span> <span class="o">=</span> <span class="n">strasse</span><span class="p">[</span><span class="n">strasse</span><span class="o">.</span><span class="n">slug</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">strasse</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stras</span> <span class="o">=</span> <span class="n">strasse</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="s2">&quot;water_name&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;street len&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># min max scale</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">stras</span><span class="p">[</span><span class="s2">&quot;street len&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stras</span><span class="p">[</span><span class="s2">&quot;street len&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">stras</span><span class="p">[</span><span class="s2">&quot;street len&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">stras</span><span class="p">[</span><span class="s2">&quot;street len&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">sbinsras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">stras</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbinsras</span><span class="o">=</span><span class="n">sbinsras</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbinsras</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Strasse&quot;</span>
<span class="n">stras</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;street len&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">land_use_agg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stras</span><span class="p">,</span> <span class="n">agg_land_use</span><span class="p">])</span>
<span class="n">land_use_agg</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">land_use_agg</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">collection_points</span> <span class="o">=</span> <span class="n">dfBeaches</span><span class="p">[</span><span class="n">dfBeaches</span><span class="o">.</span><span class="n">water</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">water_name_slug</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
</div>
<div class="section" id="local-environmental-conditions">
<h3><span class="section-number">2.2.6. </span>local environmental conditions<a class="headerlink" href="#local-environmental-conditions" title="Permalink to this headline">#</a></h3>
<p><em>define land use attributes</em></p>
<div class="section" id="distribution-of-landuse-attributes">
<h4><span class="section-number">2.2.6.1. </span>distribution of landuse attributes<a class="headerlink" href="#distribution-of-landuse-attributes" title="Permalink to this headline">#</a></h4>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/6af0237de9126d5e49fbdedf3068e9a04604b7b1ae5190de263d33ac6acea055.png" src="_images/6af0237de9126d5e49fbdedf3068e9a04604b7b1ae5190de263d33ac6acea055.png" />
</div>
</div>
</div>
<div class="section" id="correlation-of-land-use-attributes">
<h4><span class="section-number">2.2.6.2. </span>correlation of land use attributes<a class="headerlink" href="#correlation-of-land-use-attributes" title="Permalink to this headline">#</a></h4>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/4cb0d0fb499bbc8704213e8692db114ce27e8237a7486e02de29a62a95651035.png" src="_images/4cb0d0fb499bbc8704213e8692db114ce27e8237a7486e02de29a62a95651035.png" />
</div>
</div>
</div>
</div>
<div class="section" id="codes-of-interest">
<h3><span class="section-number">2.2.7. </span>Codes of interest<a class="headerlink" href="#codes-of-interest" title="Permalink to this headline">#</a></h3>
<p><em>define/explain process</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_44406 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_44406 tr:nth-child(odd) {
  background: #FFF;
}
#T_44406 tr {
  font-size: 12px;
}
#T_44406 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_44406 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
</style>
<table id="T_44406">
  <caption>Table 1: Objects of interest and threshold values.</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_44406_level0_col0" class="col_heading level0 col0" >object</th>
      <th id="T_44406_level0_col1" class="col_heading level0 col1" >threshold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_44406_level0_row0" class="row_heading level0 row0" >G10</th>
      <td id="T_44406_row0_col0" class="data row0 col0" >Food containers single use foamed or plastic</td>
      <td id="T_44406_row0_col1" class="data row0 col1" >0.010000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row1" class="row_heading level0 row1" >G100</th>
      <td id="T_44406_row1_col0" class="data row1 col0" >Medical; containers/tubes/ packaging</td>
      <td id="T_44406_row1_col1" class="data row1 col1" >0.020000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row2" class="row_heading level0 row2" >G25</th>
      <td id="T_44406_row2_col0" class="data row2 col0" >Tobacco; plastic packaging, containers</td>
      <td id="T_44406_row2_col1" class="data row2 col1" >0.020000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row3" class="row_heading level0 row3" >G27</th>
      <td id="T_44406_row3_col0" class="data row3 col0" >Cigarette filters</td>
      <td id="T_44406_row3_col1" class="data row3 col1" >0.470000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row4" class="row_heading level0 row4" >G30</th>
      <td id="T_44406_row4_col0" class="data row4 col0" >Food wrappers; candy, snacks</td>
      <td id="T_44406_row4_col1" class="data row4 col1" >0.210000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row5" class="row_heading level0 row5" >G31</th>
      <td id="T_44406_row5_col0" class="data row5 col0" >Lollypop sticks</td>
      <td id="T_44406_row5_col1" class="data row5 col1" >0.030000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row6" class="row_heading level0 row6" >G32</th>
      <td id="T_44406_row6_col0" class="data row6 col0" >Toys and party favors</td>
      <td id="T_44406_row6_col1" class="data row6 col1" >0.030000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row7" class="row_heading level0 row7" >G33</th>
      <td id="T_44406_row7_col0" class="data row7 col0" >Cups, lids, single use foamed and hard plastic</td>
      <td id="T_44406_row7_col1" class="data row7 col1" >0.020000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row8" class="row_heading level0 row8" >G35</th>
      <td id="T_44406_row8_col0" class="data row8 col0" >Straws and stirrers</td>
      <td id="T_44406_row8_col1" class="data row8 col1" >0.040000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row9" class="row_heading level0 row9" >G67</th>
      <td id="T_44406_row9_col0" class="data row9 col0" >Industrial sheeting</td>
      <td id="T_44406_row9_col1" class="data row9 col1" >0.090000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row10" class="row_heading level0 row10" >G70</th>
      <td id="T_44406_row10_col0" class="data row10 col0" >Shotgun cartridges</td>
      <td id="T_44406_row10_col1" class="data row10 col1" >0.010000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row11" class="row_heading level0 row11" >G89</th>
      <td id="T_44406_row11_col0" class="data row11 col0" >Plastic construction waste</td>
      <td id="T_44406_row11_col1" class="data row11 col1" >0.060000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row12" class="row_heading level0 row12" >G95</th>
      <td id="T_44406_row12_col0" class="data row12 col0" >Cotton bud/swab sticks</td>
      <td id="T_44406_row12_col1" class="data row12 col1" >0.120000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row13" class="row_heading level0 row13" >Gcaps</th>
      <td id="T_44406_row13_col0" class="data row13 col0" >Plastic bottle lids</td>
      <td id="T_44406_row13_col1" class="data row13 col1" >0.110000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row14" class="row_heading level0 row14" >Gfoam</th>
      <td id="T_44406_row14_col0" class="data row14 col0" >Expanded polystyrene</td>
      <td id="T_44406_row14_col1" class="data row14 col1" >0.280000</td>
    </tr>
    <tr>
      <th id="T_44406_level0_row15" class="row_heading level0 row15" >Gfrags</th>
      <td id="T_44406_row15_col0" class="data row15 col0" >Fragmented plastics</td>
      <td id="T_44406_row15_col1" class="data row15 col1" >0.610000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># classess</span>

<span class="k">class</span> <span class="nc">KAndNPriorLikelihood</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">land_use_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">prior_locations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">regional_locations</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">codes_of_interest</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span> <span class="o">=</span> <span class="n">land_use_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_locations</span> <span class="o">=</span> <span class="n">prior_locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">uses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regional_locations</span> <span class="o">=</span> <span class="n">regional_locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_results</span> <span class="o">=</span> <span class="n">prior_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_results</span> <span class="o">=</span> <span class="n">current_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span> <span class="o">=</span> <span class="n">codes_of_interest</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_bin_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">prior_bin_numbers</span> <span class="o">=</span> <span class="n">collect_regional_land_use_bins</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_locations</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">prior_bin_numbers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">prior_bins</span> <span class="o">=</span> <span class="n">land_use_data_for_group_of_locations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_bin_numbers</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">prior_bins</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">location_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[[]]:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">locations_per_bin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mask</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[]:</span>
        <span class="n">_</span> <span class="p">,</span> <span class="n">p_totals</span> <span class="o">=</span> <span class="n">prior_magnitude_for_a_period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">prior_totals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cois</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p_totals</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">prior_totals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>

        <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_k_and_n</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regional_locations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_results</span><span class="p">[</span><span class="n">c_results</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">x</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">]</span>

        <span class="n">magnitudes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">magnitudes</span>

<span class="k">class</span> <span class="nc">ProbabilityOfX</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_results</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_results</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_results</span> <span class="o">=</span> <span class="n">current_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_results</span> <span class="o">=</span> <span class="n">prior_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_probability_of_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c_range</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_results</span><span class="p">,</span> <span class="n">arange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c_range</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_probability_of_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p_range</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_results</span><span class="p">,</span> <span class="n">arange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p_range</span>
        

<span class="k">class</span> <span class="nc">LikelihoodAndPriors</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_probabilities</span><span class="p">:[[]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_probabilities</span><span class="p">:</span> <span class="p">[[]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_probabilities</span> <span class="o">=</span> <span class="n">current_probabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_probabilities</span> <span class="o">=</span> <span class="n">prior_probabilities</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">likelihoods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_probabilities</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">priors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_probabilities</span><span class="p">]</span>



<span class="c1"># helper functions for results display</span>
<span class="k">def</span> <span class="nf">dataframe_row_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">for_now</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: year three posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">for_now</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="k">return</span> <span class="n">for_now</span>
    
<span class="k">class</span> <span class="nc">PForAGroupOfCodes</span><span class="p">():</span>

  
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_similar_locations</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unopinionated_prior</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">time_prior</span><span class="p">:</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">codes_of_interest</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_similar_locations</span> <span class="o">=</span> <span class="n">prior_similar_locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unopinionated_prior</span> <span class="o">=</span> <span class="n">unopinionated_prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span> <span class="o">=</span> <span class="n">codes_of_interest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_prior</span> <span class="o">=</span> <span class="n">time_prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caption</span> <span class="o">=</span> <span class="n">caption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">informed_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">informed</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_prior_to_df</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_similar_locations</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">informed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uninformed_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uninformed</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_prior_to_df</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unopinionated_prior</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">uninformed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequential_prior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sequential</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_prior_to_df</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_prior</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">sequential</span>

    <span class="nd">@property</span>    
    <span class="k">def</span> <span class="nf">informed_posterior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">informed</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">informed_prior</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">informed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uninformed_posterior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uninformed</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uninformed_prior</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">uninformed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequential_posterior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sequential</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sequential_prior</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">sequential</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">combined_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">index</span><span class="o">=</span> <span class="n">dataframe_row_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_labels</span><span class="p">)</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">informed_posterior</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sequential_posterior</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uninformed_posterior</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="n">display</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caption</span><span class="p">)</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">(</span><span class="n">table_css_styles</span><span class="p">)</span>



        <span class="k">return</span> <span class="n">display</span>


<span class="k">class</span> <span class="nc">ProbabilityForACity</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_survey_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">land_use_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">codes_of_interest</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_results</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">unopinionated</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_survey_results</span> <span class="o">=</span> <span class="n">current_survey_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span> <span class="o">=</span> <span class="n">land_use_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span> <span class="o">=</span> <span class="n">codes_of_interest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_survey_results</span> <span class="o">=</span> <span class="n">prior_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unopinionated</span> <span class="o">=</span> <span class="n">unopinionated</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">city_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_survey_results</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_survey_results</span><span class="p">[</span><span class="n">locs</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">locations</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_locations_bins</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]):</span>
        <span class="n">locations_bins_use</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations_of_interest</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">locations_of_interest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_locations</span><span class="p">]</span>
        <span class="n">use_and_bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">locations_bins_use</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">locations_bins_use</span><span class="p">,</span> <span class="n">use_and_bins</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">locations_per_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">([[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]],</span> <span class="p">[[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">cs_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_locations_bins</span>
        <span class="n">mask_bool</span><span class="p">,</span> <span class="n">locations</span> <span class="o">=</span> <span class="n">bins_and_locations</span><span class="p">(</span><span class="n">cs_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mask_bool</span><span class="p">,</span> <span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">prior_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locations_per_bin</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">prior_locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_survey_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">]</span>
        <span class="n">prior_totals_city</span><span class="p">,</span> <span class="n">prior_use_city</span>  <span class="o">=</span> <span class="n">prior_magnitudes_for_group</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prior_totals_city</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_magnitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">city_locations</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_survey_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_of_interest</span><span class="p">]</span>
        <span class="n">mags_city</span> <span class="o">=</span> <span class="n">current_magnitudes_for_group</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mags_city</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_probability_of_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wec</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wec</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prior_probability_of_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">psc</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">)</span>
        <span class="n">likely_c</span> <span class="o">=</span> <span class="n">probability_per_magnitude_df</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">psc</span><span class="p">,</span> <span class="n">likely_c</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unopinionated_prior_probability_of_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">psc</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unopinionated</span><span class="p">)</span>
        <span class="n">likelypriors_c</span> <span class="o">=</span> <span class="n">probability_per_magnitude_df</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">psc</span><span class="p">,</span> <span class="n">likelypriors_c</span>
</pre></div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="section" id="sampling-period-one-november-2015-november-2016">
<h2><span class="section-number">2.3. </span>Sampling period one: November 2015 - November 2016<a class="headerlink" href="#sampling-period-one-november-2015-november-2016" title="Permalink to this headline">#</a></h2>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/0450d3a2d4e55d597d9ea21f7384c2487f4ef28ee6c8ad51b7983c79c711ba80.png" src="_images/0450d3a2d4e55d597d9ea21f7384c2487f4ef28ee6c8ad51b7983c79c711ba80.png" />
</div>
</div>
<div class="section" id="chance-of-exceeding-threshold-lake">
<h3><span class="section-number">2.3.1. </span>Chance of exceeding threshold: lake<a class="headerlink" href="#chance-of-exceeding-threshold-lake" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">nbinom</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">beta</span>

<span class="k">def</span> <span class="nf">check_nk</span><span class="p">(</span><span class="n">anarray</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">gthan</span> <span class="o">=</span> <span class="p">(</span><span class="n">anarray</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">pnk</span> <span class="o">=</span> <span class="n">gthan</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">anarray</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pnk</span><span class="p">,</span> <span class="n">gthan</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">anarray</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">a_nbdist</span><span class="p">(</span><span class="n">anarray</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">anarray</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">anarray</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="n">sigma</span>    
    <span class="n">n</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span>

    <span class="n">nbrv</span> <span class="o">=</span> <span class="n">nbinom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nbrv</span>
    
    
<span class="k">def</span> <span class="nf">a_gammadist</span><span class="p">(</span><span class="n">anarray</span><span class="p">,</span> <span class="n">afunc</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">afunc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">afunc</span><span class="p">(</span><span class="n">anarray</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">anarray</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="mf">.001</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">anarray</span><span class="p">)</span>

    <span class="n">gammadist</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gammadist</span>


<span class="k">def</span> <span class="nf">make_inference_from_cdf</span><span class="p">(</span><span class="n">prior_dist</span><span class="p">,</span> <span class="n">current_dist</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>

    <span class="c1"># hnot: the chance of equal to or greater than threshold</span>
    <span class="n">aprior</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">prior_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">lhood</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">current_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>

    <span class="c1"># hone: the chance that the threshold is not exceeded</span>
    <span class="n">hone_prior</span> <span class="o">=</span> <span class="n">prior_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">hone_lhod</span> <span class="o">=</span> <span class="n">current_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>

    <span class="n">normalise</span> <span class="o">=</span> <span class="p">(</span><span class="n">hone_prior</span><span class="o">*</span><span class="n">hone_lhod</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">aprior</span><span class="o">*</span><span class="n">lhood</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">aprior</span><span class="o">*</span><span class="n">lhood</span><span class="p">)</span><span class="o">/</span><span class="n">normalise</span><span class="p">,</span> <span class="p">(</span><span class="n">hone_prior</span><span class="o">*</span><span class="n">hone_lhod</span><span class="p">)</span><span class="o">/</span><span class="n">normalise</span>

<span class="k">def</span> <span class="nf">prior_magnitude_for_a_period</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">totals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">acode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cois</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">p_results</span><span class="p">[</span><span class="n">p_results</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">acode</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">by_use</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># this is pcs_m for for a land use attribute</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">alist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">masked</span><span class="p">):</span>
            <span class="n">ksandns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">retrieve_k_and_n</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">p_results</span><span class="p">[</span><span class="n">p_results</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">acode</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">tholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">acode</span><span class="p">],</span> <span class="n">magnitude</span><span class="o">=</span><span class="n">magnitude</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ksandns</span><span class="p">)</span>
            <span class="n">k_and_ns</span> <span class="o">=</span> <span class="p">{</span><span class="n">uses</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">ksandns</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="n">by_use</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">k_and_ns</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">acode</span><span class="p">:</span><span class="n">by_use</span><span class="p">})</span>
        <span class="n">totals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">acode</span><span class="p">:</span><span class="n">vals</span><span class="p">})</span>
    
    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">totals</span>


<span class="k">def</span> <span class="nf">collect_regional_land_use_bins</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior_locations</span><span class="p">):</span>
    <span class="n">prior_lake</span> <span class="o">=</span> <span class="n">p_ludata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prior_locations</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">prior_lake</span>    

<span class="k">def</span> <span class="nf">land_use_data_for_group_of_locations</span><span class="p">(</span><span class="n">prior_lake</span><span class="p">):</span>
    <span class="n">prior_bins</span> <span class="o">=</span> <span class="n">prior_lake</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">prior_bins</span>

<span class="k">def</span> <span class="nf">locations_per_bin</span><span class="p">(</span><span class="n">prior_bins</span><span class="p">,</span> <span class="n">p_ludata</span><span class="p">,</span> <span class="n">uses</span><span class="p">):</span>

    <span class="n">bin_numbers_per_use</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_masks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prior_bins</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">p_ludata</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">uses</span><span class="p">]</span>
    <span class="n">locations_per_bin</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_similar_locations</span><span class="p">(</span><span class="n">list_of_binnumbers</span><span class="p">,</span> <span class="n">p_ludata</span><span class="p">)</span> <span class="k">for</span> <span class="n">list_of_binnumbers</span> <span class="ow">in</span> <span class="n">bin_numbers_per_use</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">locations_per_bin</span>

<span class="k">def</span> <span class="nf">make_table_of_priors_by_bin</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">uninformative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">tprior</span> <span class="o">=</span> <span class="n">prior_k_n_for_a_period</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span>
    <span class="n">a_prior</span> <span class="o">=</span> <span class="n">k_over_n_for_prior_k_n</span><span class="p">(</span><span class="n">tprior</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">uninformative</span><span class="p">:</span>
        <span class="n">a_prior</span> <span class="o">=</span> <span class="n">a_prior</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">.5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a_prior</span>
        
<span class="k">def</span> <span class="nf">make_table_of_likelihoods</span><span class="p">(</span><span class="n">lake_locations</span><span class="p">,</span> <span class="n">c_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
    <span class="n">lhood</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_k_and_n</span><span class="p">(</span><span class="n">lake_locations</span><span class="p">,</span> <span class="n">c_results</span><span class="p">[</span><span class="n">c_results</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">x</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">tholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cois</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lhood</span>

<span class="k">def</span> <span class="nf">posterior_dist_p</span><span class="p">(</span><span class="n">lhood</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">):</span>
    
    <span class="c1"># k/n of the current surveys</span>
    <span class="n">hnot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lhood</span><span class="p">])</span>

    <span class="c1"># if x = 1 or 0 correct to 0.01 or 0.99</span>
    <span class="n">hnot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">.001</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hnot</span><span class="p">]</span>
    <span class="n">hnot</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">.999</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hnot</span><span class="p">]</span>

    <span class="c1"># one - the likelihood</span>
    <span class="n">hone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">hnot</span><span class="p">])</span>

    <span class="c1"># likelihood * prior</span>
    <span class="n">phnot</span> <span class="o">=</span> <span class="n">a_prior</span> <span class="o">*</span> <span class="n">hnot</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a_prior</span><span class="p">]</span> <span class="o">*</span> <span class="n">hone</span>

    <span class="c1"># normalizing constant</span>
    <span class="n">ptot</span> <span class="o">=</span> <span class="n">phnot</span> <span class="o">+</span> <span class="n">phone</span>
        
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">phnot</span><span class="o">/</span><span class="n">ptot</span><span class="p">,</span> <span class="n">phone</span><span class="o">/</span><span class="n">ptot</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hnot&quot;</span><span class="p">,</span> <span class="s2">&quot;hone&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">posterior</span>
    
<span class="k">def</span> <span class="nf">p_per_unit</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">arange</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">)):</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">alist</span> <span class="ow">in</span> <span class="n">mags</span><span class="p">:</span>
        <span class="n">alist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span>
        <span class="n">wexp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span> <span class="n">alist</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">])</span>
        <span class="n">wexp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">.01</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wexp</span><span class="p">]</span>
        <span class="n">wexp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">.99</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wexp</span><span class="p">]</span>
        <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wexp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ps</span>

<span class="k">def</span> <span class="nf">add_prior_to_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">priors</span><span class="p">):</span>

    <span class="c1"># add the k/n from priors to the likelihood df</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prior&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priors</span><span class="p">[</span><span class="s2">&quot;k/n&quot;</span><span class="p">]</span>

    <span class="c1"># the probability that the threshold was not exceeded</span>
    <span class="c1"># from both the likelihood and prior</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;k/n&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notpr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prior&quot;</span><span class="p">]</span>

    <span class="c1"># likelihood time the prior for both hypothesis</span>
    <span class="c1"># the prior threshhold was exceeded or not</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;lh*prior&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;prior&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;k/n&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notp*notpr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notp&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;notpr&quot;</span><span class="p">]</span>

    <span class="c1"># the total probability considering the two hypothesis</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ptot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notp*notpr&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;lh*prior&quot;</span><span class="p">]</span>

    <span class="c1"># the normalized probability</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;lh*prior&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ptot&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>
<span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">k_and_n_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;land_use_data&quot;</span><span class="p">:</span> <span class="n">p_ludata</span><span class="p">,</span>
    <span class="s2">&quot;prior_locations&quot;</span><span class="p">:</span> <span class="n">prior_locations</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">uses</span><span class="p">,</span>
    <span class="s2">&quot;regional_locations&quot;</span><span class="p">:</span><span class="n">lake_locations</span><span class="p">,</span>
    <span class="s2">&quot;prior_results&quot;</span><span class="p">:</span> <span class="n">p_results</span><span class="p">,</span>
    <span class="s2">&quot;current_results&quot;</span><span class="p">:</span> <span class="n">c_results</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span>
<span class="p">}</span>

<span class="n">kandps</span> <span class="o">=</span> <span class="n">KAndNPriorLikelihood</span><span class="p">(</span><span class="o">**</span><span class="n">k_and_n_args</span><span class="p">)</span>
<span class="n">pkandns</span> <span class="o">=</span> <span class="n">ProbabilityOfX</span><span class="p">(</span><span class="n">current_results</span><span class="o">=</span><span class="n">kandps</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">,</span> <span class="n">prior_results</span><span class="o">=</span><span class="n">kandps</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="n">landp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_probabilities&quot;</span><span class="p">:</span> <span class="n">pkandns</span><span class="o">.</span><span class="n">current_probability_of_x</span><span class="p">,</span>
    <span class="s2">&quot;prior_probabilities&quot;</span><span class="p">:</span> <span class="n">pkandns</span><span class="o">.</span><span class="n">prior_probability_of_x</span>
<span class="p">}</span>

<span class="n">likelihood_and_priors</span> <span class="o">=</span> <span class="n">LikelihoodAndPriors</span><span class="p">(</span><span class="o">**</span><span class="n">landp_args</span><span class="p">)</span>
<span class="n">uninformative4</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">up</span> <span class="p">]</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;likelihood&quot;</span><span class="p">:</span><span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
    <span class="s2">&quot;prior_similar_locations&quot;</span><span class="p">:</span> <span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
    <span class="s2">&quot;unopinionated_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;time_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4</span><span class="p">,</span>
    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table 12&quot;</span>
<span class="p">}</span>

<span class="n">year_one</span> <span class="o">=</span> <span class="n">PForAGroupOfCodes</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">year_one</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: uninformed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
<span class="n">year_one</span><span class="o">.</span><span class="n">combined_results</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_d95b1 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_d95b1 tr:nth-child(odd) {
  background: #FFF;
}
#T_d95b1 tr {
  font-size: 12px;
}
#T_d95b1 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_d95b1 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
#T_d95b1_row0_col0 {
  background-color: #fec45f;
  color: #000000;
}
#T_d95b1_row0_col1 {
  background-color: #fc6330;
  color: #f1f1f1;
}
#T_d95b1_row0_col2 {
  background-color: #c00225;
  color: #f1f1f1;
}
#T_d95b1_row0_col3 {
  background-color: #b60026;
  color: #f1f1f1;
}
#T_d95b1_row0_col4 {
  background-color: #fd7636;
  color: #f1f1f1;
}
#T_d95b1_row0_col5 {
  background-color: #cd0b22;
  color: #f1f1f1;
}
#T_d95b1_row0_col6 {
  background-color: #fc552c;
  color: #f1f1f1;
}
#T_d95b1_row0_col7 {
  background-color: #feab49;
  color: #000000;
}
#T_d95b1_row0_col8 {
  background-color: #fec662;
  color: #000000;
}
#T_d95b1_row0_col9, #T_d95b1_row1_col9, #T_d95b1_row2_col9 {
  background-color: #fd8c3c;
  color: #f1f1f1;
}
#T_d95b1_row0_col10 {
  background-color: #fed470;
  color: #000000;
}
#T_d95b1_row0_col11, #T_d95b1_row0_col15 {
  background-color: #fd7234;
  color: #f1f1f1;
}
#T_d95b1_row0_col12 {
  background-color: #e8241f;
  color: #f1f1f1;
}
#T_d95b1_row0_col13 {
  background-color: #e1191d;
  color: #f1f1f1;
}
#T_d95b1_row0_col14 {
  background-color: #b00026;
  color: #f1f1f1;
}
#T_d95b1_row1_col0, #T_d95b1_row2_col0 {
  background-color: #fea647;
  color: #000000;
}
#T_d95b1_row1_col1, #T_d95b1_row2_col1 {
  background-color: #fd7435;
  color: #f1f1f1;
}
#T_d95b1_row1_col2, #T_d95b1_row2_col2 {
  background-color: #e9261f;
  color: #f1f1f1;
}
#T_d95b1_row1_col3, #T_d95b1_row1_col14, #T_d95b1_row2_col3, #T_d95b1_row2_col14 {
  background-color: #e41c1d;
  color: #f1f1f1;
}
#T_d95b1_row1_col4, #T_d95b1_row1_col11, #T_d95b1_row1_col15, #T_d95b1_row2_col4, #T_d95b1_row2_col11, #T_d95b1_row2_col15 {
  background-color: #fd8038;
  color: #f1f1f1;
}
#T_d95b1_row1_col5, #T_d95b1_row2_col5 {
  background-color: #f13624;
  color: #f1f1f1;
}
#T_d95b1_row1_col6, #T_d95b1_row2_col6 {
  background-color: #fd6e33;
  color: #f1f1f1;
}
#T_d95b1_row1_col7, #T_d95b1_row2_col7 {
  background-color: #fd9c42;
  color: #000000;
}
#T_d95b1_row1_col8, #T_d95b1_row2_col8 {
  background-color: #fea948;
  color: #000000;
}
#T_d95b1_row1_col10, #T_d95b1_row2_col10 {
  background-color: #feb24c;
  color: #000000;
}
#T_d95b1_row1_col12, #T_d95b1_row2_col12 {
  background-color: #fc4f2a;
  color: #f1f1f1;
}
#T_d95b1_row1_col13, #T_d95b1_row2_col13 {
  background-color: #fa4a29;
  color: #f1f1f1;
}
</style>
<table id="T_d95b1">
  <caption>Table 12</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_d95b1_level0_col0" class="col_heading level0 col0" >Gfrags</th>
      <th id="T_d95b1_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_d95b1_level0_col2" class="col_heading level0 col2" >G27</th>
      <th id="T_d95b1_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_d95b1_level0_col4" class="col_heading level0 col4" >G95</th>
      <th id="T_d95b1_level0_col5" class="col_heading level0 col5" >Gcaps</th>
      <th id="T_d95b1_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_d95b1_level0_col7" class="col_heading level0 col7" >G35</th>
      <th id="T_d95b1_level0_col8" class="col_heading level0 col8" >G89</th>
      <th id="T_d95b1_level0_col9" class="col_heading level0 col9" >G31</th>
      <th id="T_d95b1_level0_col10" class="col_heading level0 col10" >G32</th>
      <th id="T_d95b1_level0_col11" class="col_heading level0 col11" >G100</th>
      <th id="T_d95b1_level0_col12" class="col_heading level0 col12" >G33</th>
      <th id="T_d95b1_level0_col13" class="col_heading level0 col13" >G25</th>
      <th id="T_d95b1_level0_col14" class="col_heading level0 col14" >G70</th>
      <th id="T_d95b1_level0_col15" class="col_heading level0 col15" >G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d95b1_level0_row0" class="row_heading level0 row0" >prior: informed</th>
      <td id="T_d95b1_row0_col0" class="data row0 col0" >0.32</td>
      <td id="T_d95b1_row0_col1" class="data row0 col1" >0.58</td>
      <td id="T_d95b1_row0_col2" class="data row0 col2" >0.87</td>
      <td id="T_d95b1_row0_col3" class="data row0 col3" >0.89</td>
      <td id="T_d95b1_row0_col4" class="data row0 col4" >0.54</td>
      <td id="T_d95b1_row0_col5" class="data row0 col5" >0.82</td>
      <td id="T_d95b1_row0_col6" class="data row0 col6" >0.61</td>
      <td id="T_d95b1_row0_col7" class="data row0 col7" >0.40</td>
      <td id="T_d95b1_row0_col8" class="data row0 col8" >0.31</td>
      <td id="T_d95b1_row0_col9" class="data row0 col9" >0.50</td>
      <td id="T_d95b1_row0_col10" class="data row0 col10" >0.27</td>
      <td id="T_d95b1_row0_col11" class="data row0 col11" >0.55</td>
      <td id="T_d95b1_row0_col12" class="data row0 col12" >0.73</td>
      <td id="T_d95b1_row0_col13" class="data row0 col13" >0.76</td>
      <td id="T_d95b1_row0_col14" class="data row0 col14" >0.90</td>
      <td id="T_d95b1_row0_col15" class="data row0 col15" >0.55</td>
    </tr>
    <tr>
      <th id="T_d95b1_level0_row1" class="row_heading level0 row1" >prior: uninformed</th>
      <td id="T_d95b1_row1_col0" class="data row1 col0" >0.41</td>
      <td id="T_d95b1_row1_col1" class="data row1 col1" >0.55</td>
      <td id="T_d95b1_row1_col2" class="data row1 col2" >0.72</td>
      <td id="T_d95b1_row1_col3" class="data row1 col3" >0.74</td>
      <td id="T_d95b1_row1_col4" class="data row1 col4" >0.52</td>
      <td id="T_d95b1_row1_col5" class="data row1 col5" >0.68</td>
      <td id="T_d95b1_row1_col6" class="data row1 col6" >0.56</td>
      <td id="T_d95b1_row1_col7" class="data row1 col7" >0.45</td>
      <td id="T_d95b1_row1_col8" class="data row1 col8" >0.40</td>
      <td id="T_d95b1_row1_col9" class="data row1 col9" >0.50</td>
      <td id="T_d95b1_row1_col10" class="data row1 col10" >0.38</td>
      <td id="T_d95b1_row1_col11" class="data row1 col11" >0.52</td>
      <td id="T_d95b1_row1_col12" class="data row1 col12" >0.62</td>
      <td id="T_d95b1_row1_col13" class="data row1 col13" >0.63</td>
      <td id="T_d95b1_row1_col14" class="data row1 col14" >0.74</td>
      <td id="T_d95b1_row1_col15" class="data row1 col15" >0.52</td>
    </tr>
    <tr>
      <th id="T_d95b1_level0_row2" class="row_heading level0 row2" >prior: 0.5</th>
      <td id="T_d95b1_row2_col0" class="data row2 col0" >0.41</td>
      <td id="T_d95b1_row2_col1" class="data row2 col1" >0.55</td>
      <td id="T_d95b1_row2_col2" class="data row2 col2" >0.72</td>
      <td id="T_d95b1_row2_col3" class="data row2 col3" >0.74</td>
      <td id="T_d95b1_row2_col4" class="data row2 col4" >0.52</td>
      <td id="T_d95b1_row2_col5" class="data row2 col5" >0.68</td>
      <td id="T_d95b1_row2_col6" class="data row2 col6" >0.56</td>
      <td id="T_d95b1_row2_col7" class="data row2 col7" >0.45</td>
      <td id="T_d95b1_row2_col8" class="data row2 col8" >0.40</td>
      <td id="T_d95b1_row2_col9" class="data row2 col9" >0.50</td>
      <td id="T_d95b1_row2_col10" class="data row2 col10" >0.38</td>
      <td id="T_d95b1_row2_col11" class="data row2 col11" >0.52</td>
      <td id="T_d95b1_row2_col12" class="data row2 col12" >0.62</td>
      <td id="T_d95b1_row2_col13" class="data row2 col13" >0.63</td>
      <td id="T_d95b1_row2_col14" class="data row2 col14" >0.74</td>
      <td id="T_d95b1_row2_col15" class="data row2 col15" >0.52</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="chance-of-exceeding-threshold-city">
<h3><span class="section-number">2.3.2. </span>Chance of exceeding threshold: city<a class="headerlink" href="#chance-of-exceeding-threshold-city" title="Permalink to this headline">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/bf66c0c8214b70a50f25533c842af6c795ab333884549cd7d63b4b186d5d7bc3.png" src="_images/bf66c0c8214b70a50f25533c842af6c795ab333884549cd7d63b4b186d5d7bc3.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bins_and_locations</span><span class="p">(</span><span class="n">cs_bins</span><span class="p">,</span> <span class="n">p_ludata</span><span class="p">):</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aset_of_bins</span> <span class="ow">in</span> <span class="n">cs_bins</span><span class="p">:</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_masks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">aset_of_bins</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">p_ludata</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aset_of_bins</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">masked</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_similar_locations</span><span class="p">(</span><span class="n">amask</span><span class="p">,</span> <span class="n">p_ludata</span><span class="p">)</span> <span class="k">for</span> <span class="n">amask</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">]</span>

        <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masks</span><span class="p">)</span>
        <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">locations</span>

<span class="k">def</span> <span class="nf">anarray_of_priors</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">cs_bins</span><span class="p">,</span> <span class="n">uninformative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">priors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">alist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locations</span><span class="p">):</span>
        <span class="n">a_prior</span> <span class="o">=</span> <span class="n">make_table_of_priors_by_bin</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">cs_bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">uninformative</span><span class="o">=</span><span class="n">uninformative</span><span class="p">)</span>
        <span class="n">priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_prior</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">priors</span>

<span class="k">def</span> <span class="nf">anarray_of_likelihoods</span><span class="p">(</span><span class="n">cities</span><span class="p">,</span> <span class="n">c_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>

    <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">cities</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">c_results</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_results</span><span class="p">[</span><span class="n">c_results</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="n">city</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>    
            
    <span class="n">likelihoods</span> <span class="o">=</span> <span class="p">[]</span>        
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">places</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locations</span><span class="p">):</span>
        <span class="n">likelihood</span> <span class="o">=</span> <span class="n">make_table_of_likelihoods</span><span class="p">(</span><span class="n">places</span><span class="p">,</span> <span class="n">c_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">)</span>
        <span class="n">likelihoods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">likelihood</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">likelihoods</span>

<span class="k">def</span> <span class="nf">anarray_of_posteriors</span><span class="p">(</span><span class="n">lhoods</span><span class="p">,</span> <span class="n">priors</span><span class="p">):</span>

    <span class="n">posts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hood</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lhoods</span><span class="p">):</span>
        <span class="n">posterior</span> <span class="o">=</span> <span class="n">posterior_dist_p</span><span class="p">(</span><span class="n">hood</span><span class="p">,</span> <span class="n">priors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">posts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posts</span>

<span class="k">def</span> <span class="nf">current_magnitudes_for_group</span><span class="p">(</span><span class="n">list_locations</span><span class="p">,</span> <span class="n">current_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">):</span>
    <span class="n">mags_current</span> <span class="o">=</span> <span class="p">[</span><span class="n">retrieve_k_and_n</span><span class="p">(</span><span class="n">list_locations</span><span class="p">,</span> <span class="n">current_results</span><span class="p">[</span><span class="n">current_results</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">x</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">thresholds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cois</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mags_current</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">prior_magnitudes_for_group</span><span class="p">(</span><span class="n">list_locations</span><span class="p">,</span> <span class="n">prior_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">):</span>
    <span class="n">prior_use_group</span><span class="p">,</span> <span class="n">prior_totals_group</span>  <span class="o">=</span> <span class="n">prior_magnitude_for_a_period</span><span class="p">(</span><span class="n">list_locations</span><span class="p">,</span> <span class="n">prior_results</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cois</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prior_totals_group</span><span class="p">)],</span> <span class="n">prior_use_group</span>

<span class="k">def</span> <span class="nf">probability_per_magnitude_df</span><span class="p">(</span><span class="n">p_mag</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">p_mag</span><span class="p">]</span>
    

<span class="k">def</span> <span class="nf">posterior_for_a_city</span><span class="p">(</span><span class="n">city_locations</span><span class="p">,</span> <span class="n">similar_locations</span><span class="p">,</span> <span class="n">c_results</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">,</span> <span class="n">alt_prior</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">mags_city</span> <span class="o">=</span> <span class="n">current_magnitudes_for_group</span><span class="p">(</span><span class="n">city_locations</span><span class="p">,</span> <span class="n">c_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">)</span>
    <span class="n">prior_totals_city</span><span class="p">,</span> <span class="n">prior_use_city</span>  <span class="o">=</span> <span class="n">prior_magnitudes_for_group</span><span class="p">(</span><span class="n">similar_locations</span><span class="p">,</span> <span class="n">p_results</span><span class="p">,</span> <span class="n">tholds</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">uses</span><span class="p">)</span>

    <span class="n">wec</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="n">mags_city</span><span class="p">)</span>
    <span class="n">psc</span> <span class="o">=</span> <span class="n">p_per_unit</span><span class="p">(</span><span class="n">prior_totals_city</span><span class="p">)</span>

    <span class="n">likely_c</span> <span class="o">=</span> <span class="n">probability_per_magnitude_df</span><span class="p">(</span><span class="n">wec</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">likelypriors_c</span> <span class="o">=</span> <span class="n">probability_per_magnitude_df</span><span class="p">(</span><span class="n">psc</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    

    <span class="n">p_prior_similar</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_prior_to_df</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">likelypriors_c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">likely_c</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">alt_prior</span><span class="p">:</span>
        <span class="n">alternate_prior</span> <span class="o">=</span> <span class="n">probability_per_magnitude_df</span><span class="p">(</span><span class="n">alt_prior</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">p_prior_un</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_prior_to_df</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">alternate_prior</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">likely_c</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">p_prior_similar</span><span class="p">,</span> <span class="n">p_prior_un</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p_prior_similar</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
<div class="section" id="sampling-period-two-april-2017-may-2018">
<h2><span class="section-number">2.4. </span>Sampling period two: April 2017 - May 2018<a class="headerlink" href="#sampling-period-two-april-2017-may-2018" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slr_d</span> <span class="o">=</span> <span class="n">make_date_object</span><span class="p">(</span><span class="s2">&quot;2017-04-01&quot;</span><span class="p">)</span>
<span class="n">slr_e</span> <span class="o">=</span> <span class="n">make_date_object</span><span class="p">(</span><span class="s2">&quot;2018-05-01&quot;</span><span class="p">)</span>
<span class="n">date_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">slr_d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">slr_e</span><span class="p">)</span>

<span class="n">lake_locations</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">date_mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">water_name_slug</span> <span class="o">==</span> <span class="s1">&#39;lac-leman&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">prior_locations</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">date_mask</span><span class="o">&amp;</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">water</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># the survey results and land use attributes associated with the locations</span>
<span class="c1"># included in the survey results</span>
<span class="n">p_results</span><span class="p">,</span> <span class="n">p_ludata</span> <span class="o">=</span> <span class="n">results_and_land_use</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">land_use_agg</span><span class="p">,</span> <span class="n">slr_e</span><span class="p">,</span> <span class="n">prior_locations</span><span class="p">,</span> <span class="n">cois</span><span class="p">)</span>
<span class="n">c_results</span> <span class="o">=</span> <span class="n">p_results</span><span class="p">[</span><span class="n">p_results</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">slr_d</span> <span class="p">]</span>
<span class="n">city_results</span> <span class="o">=</span> <span class="n">c_results</span><span class="p">[</span><span class="n">c_results</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="n">coi</span><span class="p">]</span>
<span class="n">uses</span> <span class="o">=</span> <span class="n">p_ludata</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># sample totals per code</span>
<span class="n">ctot</span> <span class="o">=</span> <span class="n">c_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">city_tot</span> <span class="o">=</span> <span class="n">city_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">city_start</span> <span class="o">=</span> <span class="n">city_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">cstart</span> <span class="o">=</span> <span class="n">c_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">cmedian</span> <span class="o">=</span> <span class="n">cstart</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/72eadba0915b0dca24942f9a33971d09b34efe8fd1cd4d01cb986e41de06f2ff.png" src="_images/72eadba0915b0dca24942f9a33971d09b34efe8fd1cd4d01cb986e41de06f2ff.png" />
</div>
</div>
<div class="section" id="id1">
<h3><span class="section-number">2.4.1. </span>Chance of exceeding threshold: lake<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="id2">
<h3><span class="section-number">2.4.2. </span>Chance of exceeding threshold: city<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/1a0226001ccc6cbdd958f9ef196c71f834f142d1e8934f157931ffb242d11241.png" src="_images/1a0226001ccc6cbdd958f9ef196c71f834f142d1e8934f157931ffb242d11241.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
<div class="section" id="sampling-period-three-april-2020-may-2021">
<h2><span class="section-number">2.5. </span>Sampling period three: April 2020 - May 2021<a class="headerlink" href="#sampling-period-three-april-2020-may-2021" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slr_d</span> <span class="o">=</span> <span class="n">make_date_object</span><span class="p">(</span><span class="s2">&quot;2020-04-01&quot;</span><span class="p">)</span>
<span class="n">slr_e</span> <span class="o">=</span> <span class="n">make_date_object</span><span class="p">(</span><span class="s2">&quot;2021-05-01&quot;</span><span class="p">)</span>
<span class="n">date_mask</span> <span class="o">=</span>  <span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">slr_d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">slr_e</span><span class="p">)</span>

<span class="n">lake_locations</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">date_mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">water_name_slug</span> <span class="o">==</span> <span class="s1">&#39;lac-leman&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">prior_locations</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[(</span><span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">slr_e</span><span class="p">)</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">water_name_slug</span> <span class="o">==</span> <span class="s1">&#39;lac-leman&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># the survey results and land use attributes associated with the locations</span>
<span class="c1"># included in the survey results</span>
<span class="n">p_results</span><span class="p">,</span> <span class="n">p_ludata</span> <span class="o">=</span> <span class="n">results_and_land_use</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">land_use_agg</span><span class="p">,</span> <span class="n">slr_e</span><span class="p">,</span> <span class="n">prior_locations</span><span class="p">,</span> <span class="n">cois</span><span class="p">)</span>

<span class="n">c_results</span> <span class="o">=</span> <span class="n">p_results</span><span class="p">[</span><span class="n">p_results</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">slr_d</span> <span class="p">]</span>
<span class="n">city_results</span> <span class="o">=</span> <span class="n">c_results</span><span class="p">[</span><span class="n">c_results</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="n">coi</span><span class="p">]</span>
<span class="n">uses</span> <span class="o">=</span> <span class="n">p_ludata</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># sample totals per code</span>
<span class="n">ctot</span> <span class="o">=</span> <span class="n">c_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">city_tot</span> <span class="o">=</span> <span class="n">city_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">city_start</span> <span class="o">=</span> <span class="n">city_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">cstart</span> <span class="o">=</span> <span class="n">c_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">cmedian</span> <span class="o">=</span> <span class="n">cstart</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/578e7ed5ff7371fc50829b768e19ae069550d50b1dab01dfb81b8a77a7856441.png" src="_images/578e7ed5ff7371fc50829b768e19ae069550d50b1dab01dfb81b8a77a7856441.png" />
</div>
</div>
<div class="section" id="id3">
<h3><span class="section-number">2.5.1. </span>Chance of exceeding threshold: lake<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>
<span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">k_and_n_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;land_use_data&quot;</span><span class="p">:</span> <span class="n">p_ludata</span><span class="p">,</span>
    <span class="s2">&quot;prior_locations&quot;</span><span class="p">:</span> <span class="n">prior_locations</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">uses</span><span class="p">,</span>
    <span class="s2">&quot;regional_locations&quot;</span><span class="p">:</span><span class="n">lake_locations</span><span class="p">,</span>
    <span class="s2">&quot;prior_results&quot;</span><span class="p">:</span> <span class="n">p_results</span><span class="p">,</span>
    <span class="s2">&quot;current_results&quot;</span><span class="p">:</span> <span class="n">c_results</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span>
<span class="p">}</span>

<span class="n">kandps</span> <span class="o">=</span> <span class="n">KAndNPriorLikelihood</span><span class="p">(</span><span class="o">**</span><span class="n">k_and_n_args</span><span class="p">)</span>
<span class="n">pkandns</span> <span class="o">=</span> <span class="n">ProbabilityOfX</span><span class="p">(</span><span class="n">current_results</span><span class="o">=</span><span class="n">kandps</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">,</span> <span class="n">prior_results</span><span class="o">=</span><span class="n">kandps</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="n">landp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_probabilities&quot;</span><span class="p">:</span> <span class="n">pkandns</span><span class="o">.</span><span class="n">current_probability_of_x</span><span class="p">,</span>
    <span class="s2">&quot;prior_probabilities&quot;</span><span class="p">:</span> <span class="n">pkandns</span><span class="o">.</span><span class="n">prior_probability_of_x</span>
<span class="p">}</span>

<span class="n">likelihood_and_priors</span> <span class="o">=</span> <span class="n">LikelihoodAndPriors</span><span class="p">(</span><span class="o">**</span><span class="n">landp_args</span><span class="p">)</span>
<span class="n">uninformative4</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">up</span> <span class="p">]</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;likelihood&quot;</span><span class="p">:</span><span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
    <span class="s2">&quot;prior_similar_locations&quot;</span><span class="p">:</span> <span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
    <span class="s2">&quot;unopinionated_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;time_prior&quot;</span><span class="p">:</span> <span class="n">year_two</span><span class="o">.</span><span class="n">uninformed_prior</span><span class="p">,</span>
    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table 12&quot;</span>
<span class="p">}</span>

<span class="n">year_three</span> <span class="o">=</span> <span class="n">PForAGroupOfCodes</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">year_three</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: year two posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
<span class="n">year_three</span><span class="o">.</span><span class="n">combined_results</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_59790 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_59790 tr:nth-child(odd) {
  background: #FFF;
}
#T_59790 tr {
  font-size: 12px;
}
#T_59790 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_59790 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
#T_59790_row0_col0, #T_59790_row0_col15 {
  background-color: #fd9d43;
  color: #000000;
}
#T_59790_row0_col1 {
  background-color: #fd7836;
  color: #f1f1f1;
}
#T_59790_row0_col2 {
  background-color: #fd7234;
  color: #f1f1f1;
}
#T_59790_row0_col3, #T_59790_row0_col6 {
  background-color: #fc6c33;
  color: #f1f1f1;
}
#T_59790_row0_col4 {
  background-color: #fc4d2a;
  color: #f1f1f1;
}
#T_59790_row0_col5, #T_59790_row0_col11, #T_59790_row1_col9 {
  background-color: #fc552c;
  color: #f1f1f1;
}
#T_59790_row0_col7, #T_59790_row2_col4, #T_59790_row2_col12 {
  background-color: #fd7a37;
  color: #f1f1f1;
}
#T_59790_row0_col8 {
  background-color: #fea145;
  color: #000000;
}
#T_59790_row0_col9 {
  background-color: #fc6631;
  color: #f1f1f1;
}
#T_59790_row0_col10 {
  background-color: #fea044;
  color: #000000;
}
#T_59790_row0_col12 {
  background-color: #fd7034;
  color: #f1f1f1;
}
#T_59790_row0_col13 {
  background-color: #fc6832;
  color: #f1f1f1;
}
#T_59790_row0_col14, #T_59790_row2_col11 {
  background-color: #fc6a32;
  color: #f1f1f1;
}
#T_59790_row1_col0 {
  background-color: #feb34d;
  color: #000000;
}
#T_59790_row1_col1 {
  background-color: #fc5f2f;
  color: #f1f1f1;
}
#T_59790_row1_col2 {
  background-color: #fd8439;
  color: #f1f1f1;
}
#T_59790_row1_col3 {
  background-color: #feb953;
  color: #000000;
}
#T_59790_row1_col4 {
  background-color: #e41c1d;
  color: #f1f1f1;
}
#T_59790_row1_col5 {
  background-color: #fa4a29;
  color: #f1f1f1;
}
#T_59790_row1_col6 {
  background-color: #fd7435;
  color: #f1f1f1;
}
#T_59790_row1_col7 {
  background-color: #fd923e;
  color: #000000;
}
#T_59790_row1_col8 {
  background-color: #ffe58f;
  color: #000000;
}
#T_59790_row1_col10 {
  background-color: #fed572;
  color: #000000;
}
#T_59790_row1_col11, #T_59790_row2_col6, #T_59790_row2_col13, #T_59790_row2_col14 {
  background-color: #fd8038;
  color: #f1f1f1;
}
#T_59790_row1_col12 {
  background-color: #fea948;
  color: #000000;
}
#T_59790_row1_col13 {
  background-color: #fd9941;
  color: #000000;
}
#T_59790_row1_col14 {
  background-color: #fee38b;
  color: #000000;
}
#T_59790_row1_col15 {
  background-color: #fece6a;
  color: #000000;
}
#T_59790_row2_col0, #T_59790_row2_col1, #T_59790_row2_col3, #T_59790_row2_col5, #T_59790_row2_col8, #T_59790_row2_col10, #T_59790_row2_col15 {
  background-color: #fd8a3b;
  color: #f1f1f1;
}
#T_59790_row2_col2 {
  background-color: #fd953f;
  color: #000000;
}
#T_59790_row2_col7, #T_59790_row2_col9 {
  background-color: #fd7636;
  color: #f1f1f1;
}
</style>
<table id="T_59790">
  <caption>Table 12</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_59790_level0_col0" class="col_heading level0 col0" >Gfrags</th>
      <th id="T_59790_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_59790_level0_col2" class="col_heading level0 col2" >G27</th>
      <th id="T_59790_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_59790_level0_col4" class="col_heading level0 col4" >G95</th>
      <th id="T_59790_level0_col5" class="col_heading level0 col5" >Gcaps</th>
      <th id="T_59790_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_59790_level0_col7" class="col_heading level0 col7" >G35</th>
      <th id="T_59790_level0_col8" class="col_heading level0 col8" >G89</th>
      <th id="T_59790_level0_col9" class="col_heading level0 col9" >G31</th>
      <th id="T_59790_level0_col10" class="col_heading level0 col10" >G32</th>
      <th id="T_59790_level0_col11" class="col_heading level0 col11" >G100</th>
      <th id="T_59790_level0_col12" class="col_heading level0 col12" >G33</th>
      <th id="T_59790_level0_col13" class="col_heading level0 col13" >G25</th>
      <th id="T_59790_level0_col14" class="col_heading level0 col14" >G70</th>
      <th id="T_59790_level0_col15" class="col_heading level0 col15" >G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_59790_level0_row0" class="row_heading level0 row0" >prior: informed</th>
      <td id="T_59790_row0_col0" class="data row0 col0" >0.45</td>
      <td id="T_59790_row0_col1" class="data row0 col1" >0.54</td>
      <td id="T_59790_row0_col2" class="data row0 col2" >0.55</td>
      <td id="T_59790_row0_col3" class="data row0 col3" >0.56</td>
      <td id="T_59790_row0_col4" class="data row0 col4" >0.63</td>
      <td id="T_59790_row0_col5" class="data row0 col5" >0.61</td>
      <td id="T_59790_row0_col6" class="data row0 col6" >0.56</td>
      <td id="T_59790_row0_col7" class="data row0 col7" >0.54</td>
      <td id="T_59790_row0_col8" class="data row0 col8" >0.43</td>
      <td id="T_59790_row0_col9" class="data row0 col9" >0.58</td>
      <td id="T_59790_row0_col10" class="data row0 col10" >0.43</td>
      <td id="T_59790_row0_col11" class="data row0 col11" >0.61</td>
      <td id="T_59790_row0_col12" class="data row0 col12" >0.56</td>
      <td id="T_59790_row0_col13" class="data row0 col13" >0.57</td>
      <td id="T_59790_row0_col14" class="data row0 col14" >0.57</td>
      <td id="T_59790_row0_col15" class="data row0 col15" >0.45</td>
    </tr>
    <tr>
      <th id="T_59790_level0_row1" class="row_heading level0 row1" >prior: year two posterior</th>
      <td id="T_59790_row1_col0" class="data row1 col0" >0.37</td>
      <td id="T_59790_row1_col1" class="data row1 col1" >0.59</td>
      <td id="T_59790_row1_col2" class="data row1 col2" >0.52</td>
      <td id="T_59790_row1_col3" class="data row1 col3" >0.35</td>
      <td id="T_59790_row1_col4" class="data row1 col4" >0.75</td>
      <td id="T_59790_row1_col5" class="data row1 col5" >0.64</td>
      <td id="T_59790_row1_col6" class="data row1 col6" >0.55</td>
      <td id="T_59790_row1_col7" class="data row1 col7" >0.48</td>
      <td id="T_59790_row1_col8" class="data row1 col8" >0.18</td>
      <td id="T_59790_row1_col9" class="data row1 col9" >0.61</td>
      <td id="T_59790_row1_col10" class="data row1 col10" >0.26</td>
      <td id="T_59790_row1_col11" class="data row1 col11" >0.52</td>
      <td id="T_59790_row1_col12" class="data row1 col12" >0.40</td>
      <td id="T_59790_row1_col13" class="data row1 col13" >0.46</td>
      <td id="T_59790_row1_col14" class="data row1 col14" >0.19</td>
      <td id="T_59790_row1_col15" class="data row1 col15" >0.29</td>
    </tr>
    <tr>
      <th id="T_59790_level0_row2" class="row_heading level0 row2" >prior: 0.5</th>
      <td id="T_59790_row2_col0" class="data row2 col0" >0.51</td>
      <td id="T_59790_row2_col1" class="data row2 col1" >0.51</td>
      <td id="T_59790_row2_col2" class="data row2 col2" >0.47</td>
      <td id="T_59790_row2_col3" class="data row2 col3" >0.51</td>
      <td id="T_59790_row2_col4" class="data row2 col4" >0.54</td>
      <td id="T_59790_row2_col5" class="data row2 col5" >0.51</td>
      <td id="T_59790_row2_col6" class="data row2 col6" >0.53</td>
      <td id="T_59790_row2_col7" class="data row2 col7" >0.55</td>
      <td id="T_59790_row2_col8" class="data row2 col8" >0.51</td>
      <td id="T_59790_row2_col9" class="data row2 col9" >0.55</td>
      <td id="T_59790_row2_col10" class="data row2 col10" >0.51</td>
      <td id="T_59790_row2_col11" class="data row2 col11" >0.57</td>
      <td id="T_59790_row2_col12" class="data row2 col12" >0.54</td>
      <td id="T_59790_row2_col13" class="data row2 col13" >0.53</td>
      <td id="T_59790_row2_col14" class="data row2 col14" >0.53</td>
      <td id="T_59790_row2_col15" class="data row2 col15" >0.51</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/67cd6fb53b17c6e0bc7ff6597c0a562601f9af472152539110db4bc1a1da0dc5.png" src="_images/67cd6fb53b17c6e0bc7ff6597c0a562601f9af472152539110db4bc1a1da0dc5.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h3><span class="section-number">2.5.2. </span>Chance of exceeding threshold: city<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/cf01126433c23d682c5320930bfad81bc36fd632d5f6718af962a77fb37f84d9.png" src="_images/cf01126433c23d682c5320930bfad81bc36fd632d5f6718af962a77fb37f84d9.png" />
</div>
</div>
</div>
<div class="section" id="id5">
<h3><span class="section-number">2.5.3. </span>Chance of exceeding threshold: city<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Genève&#39;</span><span class="p">,</span> <span class="s1">&#39;Saint-Gingolph&#39;</span><span class="p">,</span> <span class="s1">&#39;Saint-Sulpice (VD)&#39;</span><span class="p">]</span>

<span class="n">city_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">k_and_n_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">cities</span><span class="p">[</span><span class="n">city_index</span><span class="p">],</span> 
    <span class="s2">&quot;current_survey_results&quot;</span><span class="p">:</span> <span class="n">c_results</span> <span class="p">,</span>
    <span class="s2">&quot;land_use_data&quot;</span><span class="p">:</span> <span class="n">p_ludata</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span> 
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;prior_results&quot;</span><span class="p">:</span> <span class="n">p_results</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">uses</span><span class="p">,</span> 
    <span class="s2">&quot;unopinionated&quot;</span><span class="p">:</span> <span class="n">up</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">citykandps</span> <span class="o">=</span> <span class="n">ProbabilityForACity</span><span class="p">(</span><span class="o">**</span><span class="n">k_and_n_args</span><span class="p">)</span>

<span class="n">citypkandns</span> <span class="o">=</span> <span class="n">ProbabilityOfX</span><span class="p">(</span><span class="n">current_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">,</span> <span class="n">prior_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>


<span class="n">landp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">current_probability_of_x</span><span class="p">,</span>
    <span class="s2">&quot;prior_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">prior_probability_of_x</span>
<span class="p">}</span>

<span class="n">likelihood_and_priors</span> <span class="o">=</span> <span class="n">LikelihoodAndPriors</span><span class="p">(</span><span class="o">**</span><span class="n">landp_args</span><span class="p">)</span>
<span class="n">uninformative4city</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mag&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;k/n&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">})</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">up</span> <span class="p">]</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;likelihood&quot;</span><span class="p">:</span><span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
    <span class="s2">&quot;prior_similar_locations&quot;</span><span class="p">:</span> <span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
    <span class="s2">&quot;unopinionated_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4city</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;time_prior&quot;</span><span class="p">:</span> <span class="n">year_one_city_g</span><span class="o">.</span><span class="n">uninformed_prior</span><span class="p">,</span>
    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table 13: Probability of exceeding threshold at Geneva under different priors&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">year_three_city_g</span><span class="o">=</span> <span class="n">PForAGroupOfCodes</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">year_three_city_g</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: year two posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
<span class="n">year_three_city_g</span><span class="o">.</span><span class="n">combined_results</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_c5684 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_c5684 tr:nth-child(odd) {
  background: #FFF;
}
#T_c5684 tr {
  font-size: 12px;
}
#T_c5684 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_c5684 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
#T_c5684_row0_col0 {
  background-color: #ffe794;
  color: #000000;
}
#T_c5684_row0_col1 {
  background-color: #fecc68;
  color: #000000;
}
#T_c5684_row0_col2 {
  background-color: #fea446;
  color: #000000;
}
#T_c5684_row0_col3 {
  background-color: #fff5b3;
  color: #000000;
}
#T_c5684_row0_col4, #T_c5684_row0_col6 {
  background-color: #ffec9d;
  color: #000000;
}
#T_c5684_row0_col5 {
  background-color: #ffe997;
  color: #000000;
}
#T_c5684_row0_col7 {
  background-color: #feb651;
  color: #000000;
}
#T_c5684_row0_col8 {
  background-color: #ffec9f;
  color: #000000;
}
#T_c5684_row0_col9 {
  background-color: #ffefa4;
  color: #000000;
}
#T_c5684_row0_col10 {
  background-color: #ffe691;
  color: #000000;
}
#T_c5684_row0_col11 {
  background-color: #fed977;
  color: #000000;
}
#T_c5684_row0_col12 {
  background-color: #fd9d43;
  color: #000000;
}
#T_c5684_row0_col13, #T_c5684_row0_col15 {
  background-color: #feda78;
  color: #000000;
}
#T_c5684_row0_col14 {
  background-color: #fedb7b;
  color: #000000;
}
#T_c5684_row1_col0 {
  background-color: #e92720;
  color: #f1f1f1;
}
#T_c5684_row1_col1 {
  background-color: #d7121f;
  color: #f1f1f1;
}
#T_c5684_row1_col2 {
  background-color: #ee3122;
  color: #f1f1f1;
}
#T_c5684_row1_col3 {
  background-color: #be0126;
  color: #f1f1f1;
}
#T_c5684_row1_col4 {
  background-color: #fede80;
  color: #000000;
}
#T_c5684_row1_col5 {
  background-color: #feca66;
  color: #000000;
}
#T_c5684_row1_col6 {
  background-color: #fc552c;
  color: #f1f1f1;
}
#T_c5684_row1_col7, #T_c5684_row2_col7 {
  background-color: #feb24c;
  color: #000000;
}
#T_c5684_row1_col8 {
  background-color: #fff0a8;
  color: #000000;
}
#T_c5684_row1_col9 {
  background-color: #fff5b5;
  color: #000000;
}
#T_c5684_row1_col10 {
  background-color: #fff1a9;
  color: #000000;
}
#T_c5684_row1_col11, #T_c5684_row1_col13, #T_c5684_row1_col14 {
  background-color: #ffea9b;
  color: #000000;
}
#T_c5684_row1_col12 {
  background-color: #ed2e21;
  color: #f1f1f1;
}
#T_c5684_row1_col15 {
  background-color: #ffe48c;
  color: #000000;
}
#T_c5684_row2_col0, #T_c5684_row2_col8 {
  background-color: #fee38b;
  color: #000000;
}
#T_c5684_row2_col1, #T_c5684_row2_col10, #T_c5684_row2_col11, #T_c5684_row2_col13, #T_c5684_row2_col14 {
  background-color: #fed976;
  color: #000000;
}
#T_c5684_row2_col2, #T_c5684_row2_col15 {
  background-color: #fec561;
  color: #000000;
}
#T_c5684_row2_col3 {
  background-color: #fff6b6;
  color: #000000;
}
#T_c5684_row2_col4, #T_c5684_row2_col5, #T_c5684_row2_col6, #T_c5684_row2_col9 {
  background-color: #ffeda0;
  color: #000000;
}
#T_c5684_row2_col12 {
  background-color: #fd9f44;
  color: #000000;
}
</style>
<table id="T_c5684">
  <caption>Table 13: Probability of exceeding threshold at Geneva under different priors</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_c5684_level0_col0" class="col_heading level0 col0" >Gfrags</th>
      <th id="T_c5684_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_c5684_level0_col2" class="col_heading level0 col2" >G27</th>
      <th id="T_c5684_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_c5684_level0_col4" class="col_heading level0 col4" >G95</th>
      <th id="T_c5684_level0_col5" class="col_heading level0 col5" >Gcaps</th>
      <th id="T_c5684_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_c5684_level0_col7" class="col_heading level0 col7" >G35</th>
      <th id="T_c5684_level0_col8" class="col_heading level0 col8" >G89</th>
      <th id="T_c5684_level0_col9" class="col_heading level0 col9" >G31</th>
      <th id="T_c5684_level0_col10" class="col_heading level0 col10" >G32</th>
      <th id="T_c5684_level0_col11" class="col_heading level0 col11" >G100</th>
      <th id="T_c5684_level0_col12" class="col_heading level0 col12" >G33</th>
      <th id="T_c5684_level0_col13" class="col_heading level0 col13" >G25</th>
      <th id="T_c5684_level0_col14" class="col_heading level0 col14" >G70</th>
      <th id="T_c5684_level0_col15" class="col_heading level0 col15" >G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c5684_level0_row0" class="row_heading level0 row0" >prior: informed</th>
      <td id="T_c5684_row0_col0" class="data row0 col0" >0.16</td>
      <td id="T_c5684_row0_col1" class="data row0 col1" >0.29</td>
      <td id="T_c5684_row0_col2" class="data row0 col2" >0.42</td>
      <td id="T_c5684_row0_col3" class="data row0 col3" >0.07</td>
      <td id="T_c5684_row0_col4" class="data row0 col4" >0.14</td>
      <td id="T_c5684_row0_col5" class="data row0 col5" >0.15</td>
      <td id="T_c5684_row0_col6" class="data row0 col6" >0.14</td>
      <td id="T_c5684_row0_col7" class="data row0 col7" >0.36</td>
      <td id="T_c5684_row0_col8" class="data row0 col8" >0.13</td>
      <td id="T_c5684_row0_col9" class="data row0 col9" >0.12</td>
      <td id="T_c5684_row0_col10" class="data row0 col10" >0.17</td>
      <td id="T_c5684_row0_col11" class="data row0 col11" >0.25</td>
      <td id="T_c5684_row0_col12" class="data row0 col12" >0.45</td>
      <td id="T_c5684_row0_col13" class="data row0 col13" >0.24</td>
      <td id="T_c5684_row0_col14" class="data row0 col14" >0.24</td>
      <td id="T_c5684_row0_col15" class="data row0 col15" >0.24</td>
    </tr>
    <tr>
      <th id="T_c5684_level0_row1" class="row_heading level0 row1" >prior: year two posterior</th>
      <td id="T_c5684_row1_col0" class="data row1 col0" >0.72</td>
      <td id="T_c5684_row1_col1" class="data row1 col1" >0.79</td>
      <td id="T_c5684_row1_col2" class="data row1 col2" >0.69</td>
      <td id="T_c5684_row1_col3" class="data row1 col3" >0.87</td>
      <td id="T_c5684_row1_col4" class="data row1 col4" >0.22</td>
      <td id="T_c5684_row1_col5" class="data row1 col5" >0.30</td>
      <td id="T_c5684_row1_col6" class="data row1 col6" >0.61</td>
      <td id="T_c5684_row1_col7" class="data row1 col7" >0.38</td>
      <td id="T_c5684_row1_col8" class="data row1 col8" >0.10</td>
      <td id="T_c5684_row1_col9" class="data row1 col9" >0.07</td>
      <td id="T_c5684_row1_col10" class="data row1 col10" >0.10</td>
      <td id="T_c5684_row1_col11" class="data row1 col11" >0.14</td>
      <td id="T_c5684_row1_col12" class="data row1 col12" >0.70</td>
      <td id="T_c5684_row1_col13" class="data row1 col13" >0.14</td>
      <td id="T_c5684_row1_col14" class="data row1 col14" >0.14</td>
      <td id="T_c5684_row1_col15" class="data row1 col15" >0.19</td>
    </tr>
    <tr>
      <th id="T_c5684_level0_row2" class="row_heading level0 row2" >prior: 0.5</th>
      <td id="T_c5684_row2_col0" class="data row2 col0" >0.19</td>
      <td id="T_c5684_row2_col1" class="data row2 col1" >0.25</td>
      <td id="T_c5684_row2_col2" class="data row2 col2" >0.31</td>
      <td id="T_c5684_row2_col3" class="data row2 col3" >0.06</td>
      <td id="T_c5684_row2_col4" class="data row2 col4" >0.12</td>
      <td id="T_c5684_row2_col5" class="data row2 col5" >0.12</td>
      <td id="T_c5684_row2_col6" class="data row2 col6" >0.12</td>
      <td id="T_c5684_row2_col7" class="data row2 col7" >0.38</td>
      <td id="T_c5684_row2_col8" class="data row2 col8" >0.19</td>
      <td id="T_c5684_row2_col9" class="data row2 col9" >0.12</td>
      <td id="T_c5684_row2_col10" class="data row2 col10" >0.25</td>
      <td id="T_c5684_row2_col11" class="data row2 col11" >0.25</td>
      <td id="T_c5684_row2_col12" class="data row2 col12" >0.44</td>
      <td id="T_c5684_row2_col13" class="data row2 col13" >0.25</td>
      <td id="T_c5684_row2_col14" class="data row2 col14" >0.25</td>
      <td id="T_c5684_row2_col15" class="data row2 col15" >0.31</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_index</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">k_and_n_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">cities</span><span class="p">[</span><span class="n">city_index</span><span class="p">],</span> 
    <span class="s2">&quot;current_survey_results&quot;</span><span class="p">:</span> <span class="n">c_results</span> <span class="p">,</span>
    <span class="s2">&quot;land_use_data&quot;</span><span class="p">:</span> <span class="n">p_ludata</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span> 
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;prior_results&quot;</span><span class="p">:</span> <span class="n">p_results</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">uses</span><span class="p">,</span> 
    <span class="s2">&quot;unopinionated&quot;</span><span class="p">:</span> <span class="n">up</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">citykandps</span> <span class="o">=</span> <span class="n">ProbabilityForACity</span><span class="p">(</span><span class="o">**</span><span class="n">k_and_n_args</span><span class="p">)</span>

<span class="n">citypkandns</span> <span class="o">=</span> <span class="n">ProbabilityOfX</span><span class="p">(</span><span class="n">current_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">,</span> <span class="n">prior_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="n">landp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">current_probability_of_x</span><span class="p">,</span>
    <span class="s2">&quot;prior_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">prior_probability_of_x</span>
<span class="p">}</span>

<span class="n">likelihood_and_priors</span> <span class="o">=</span> <span class="n">LikelihoodAndPriors</span><span class="p">(</span><span class="o">**</span><span class="n">landp_args</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;likelihood&quot;</span><span class="p">:</span><span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
    <span class="s2">&quot;prior_similar_locations&quot;</span><span class="p">:</span> <span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
    <span class="s2">&quot;unopinionated_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4city</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;time_prior&quot;</span><span class="p">:</span> <span class="n">year_two_city_stg</span><span class="o">.</span><span class="n">uninformed_prior</span><span class="p">,</span>
    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table 13: Probability of exceeding threshold at Saint Gingolph under different priors&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">year_three_city_sg</span><span class="o">=</span> <span class="n">PForAGroupOfCodes</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">year_three_city_sg</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span>  <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: year two posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
<span class="n">year_three_city_sg</span><span class="o">.</span><span class="n">combined_results</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_48f33 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_48f33 tr:nth-child(odd) {
  background: #FFF;
}
#T_48f33 tr {
  font-size: 12px;
}
#T_48f33 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_48f33 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
#T_48f33_row0_col0 {
  background-color: #a10026;
  color: #f1f1f1;
}
#T_48f33_row0_col1 {
  background-color: #970026;
  color: #f1f1f1;
}
#T_48f33_row0_col2 {
  background-color: #ffeda1;
  color: #000000;
}
#T_48f33_row0_col3, #T_48f33_row0_col4, #T_48f33_row0_col9, #T_48f33_row0_col14, #T_48f33_row0_col15, #T_48f33_row1_col1, #T_48f33_row1_col3, #T_48f33_row1_col4, #T_48f33_row1_col5, #T_48f33_row1_col6, #T_48f33_row1_col9, #T_48f33_row1_col10, #T_48f33_row1_col11, #T_48f33_row1_col13, #T_48f33_row1_col14, #T_48f33_row1_col15 {
  background-color: #800026;
  color: #f1f1f1;
}
#T_48f33_row0_col5 {
  background-color: #8d0026;
  color: #f1f1f1;
}
#T_48f33_row0_col6, #T_48f33_row0_col8, #T_48f33_row0_col10, #T_48f33_row0_col12 {
  background-color: #820026;
  color: #f1f1f1;
}
#T_48f33_row0_col7 {
  background-color: #9b0026;
  color: #f1f1f1;
}
#T_48f33_row0_col11 {
  background-color: #aa0026;
  color: #f1f1f1;
}
#T_48f33_row0_col13 {
  background-color: #b20026;
  color: #f1f1f1;
}
#T_48f33_row1_col0, #T_48f33_row1_col7 {
  background-color: #fff2ac;
  color: #000000;
}
#T_48f33_row1_col2 {
  background-color: #ffffcc;
  color: #000000;
}
#T_48f33_row1_col8, #T_48f33_row1_col12 {
  background-color: #fd8e3c;
  color: #f1f1f1;
}
#T_48f33_row2_col0, #T_48f33_row2_col1, #T_48f33_row2_col5, #T_48f33_row2_col7 {
  background-color: #ac0026;
  color: #f1f1f1;
}
#T_48f33_row2_col2 {
  background-color: #ffe48d;
  color: #000000;
}
#T_48f33_row2_col3, #T_48f33_row2_col4, #T_48f33_row2_col6, #T_48f33_row2_col8, #T_48f33_row2_col9, #T_48f33_row2_col10, #T_48f33_row2_col12, #T_48f33_row2_col14, #T_48f33_row2_col15 {
  background-color: #840026;
  color: #f1f1f1;
}
#T_48f33_row2_col11, #T_48f33_row2_col13 {
  background-color: #ce0c22;
  color: #f1f1f1;
}
</style>
<table id="T_48f33">
  <caption>Table 13: Probability of exceeding threshold at Saint Gingolph under different priors</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_48f33_level0_col0" class="col_heading level0 col0" >Gfrags</th>
      <th id="T_48f33_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_48f33_level0_col2" class="col_heading level0 col2" >G27</th>
      <th id="T_48f33_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_48f33_level0_col4" class="col_heading level0 col4" >G95</th>
      <th id="T_48f33_level0_col5" class="col_heading level0 col5" >Gcaps</th>
      <th id="T_48f33_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_48f33_level0_col7" class="col_heading level0 col7" >G35</th>
      <th id="T_48f33_level0_col8" class="col_heading level0 col8" >G89</th>
      <th id="T_48f33_level0_col9" class="col_heading level0 col9" >G31</th>
      <th id="T_48f33_level0_col10" class="col_heading level0 col10" >G32</th>
      <th id="T_48f33_level0_col11" class="col_heading level0 col11" >G100</th>
      <th id="T_48f33_level0_col12" class="col_heading level0 col12" >G33</th>
      <th id="T_48f33_level0_col13" class="col_heading level0 col13" >G25</th>
      <th id="T_48f33_level0_col14" class="col_heading level0 col14" >G70</th>
      <th id="T_48f33_level0_col15" class="col_heading level0 col15" >G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_48f33_level0_row0" class="row_heading level0 row0" >prior: informed</th>
      <td id="T_48f33_row0_col0" class="data row0 col0" >0.93</td>
      <td id="T_48f33_row0_col1" class="data row0 col1" >0.95</td>
      <td id="T_48f33_row0_col2" class="data row0 col2" >0.12</td>
      <td id="T_48f33_row0_col3" class="data row0 col3" >1.00</td>
      <td id="T_48f33_row0_col4" class="data row0 col4" >1.00</td>
      <td id="T_48f33_row0_col5" class="data row0 col5" >0.97</td>
      <td id="T_48f33_row0_col6" class="data row0 col6" >1.00</td>
      <td id="T_48f33_row0_col7" class="data row0 col7" >0.94</td>
      <td id="T_48f33_row0_col8" class="data row0 col8" >0.99</td>
      <td id="T_48f33_row0_col9" class="data row0 col9" >1.00</td>
      <td id="T_48f33_row0_col10" class="data row0 col10" >1.00</td>
      <td id="T_48f33_row0_col11" class="data row0 col11" >0.91</td>
      <td id="T_48f33_row0_col12" class="data row0 col12" >1.00</td>
      <td id="T_48f33_row0_col13" class="data row0 col13" >0.89</td>
      <td id="T_48f33_row0_col14" class="data row0 col14" >1.00</td>
      <td id="T_48f33_row0_col15" class="data row0 col15" >1.00</td>
    </tr>
    <tr>
      <th id="T_48f33_level0_row1" class="row_heading level0 row1" >prior: year two posterior</th>
      <td id="T_48f33_row1_col0" class="data row1 col0" >0.09</td>
      <td id="T_48f33_row1_col1" class="data row1 col1" >1.00</td>
      <td id="T_48f33_row1_col2" class="data row1 col2" >0.00</td>
      <td id="T_48f33_row1_col3" class="data row1 col3" >1.00</td>
      <td id="T_48f33_row1_col4" class="data row1 col4" >1.00</td>
      <td id="T_48f33_row1_col5" class="data row1 col5" >1.00</td>
      <td id="T_48f33_row1_col6" class="data row1 col6" >1.00</td>
      <td id="T_48f33_row1_col7" class="data row1 col7" >0.09</td>
      <td id="T_48f33_row1_col8" class="data row1 col8" >0.50</td>
      <td id="T_48f33_row1_col9" class="data row1 col9" >1.00</td>
      <td id="T_48f33_row1_col10" class="data row1 col10" >1.00</td>
      <td id="T_48f33_row1_col11" class="data row1 col11" >1.00</td>
      <td id="T_48f33_row1_col12" class="data row1 col12" >0.50</td>
      <td id="T_48f33_row1_col13" class="data row1 col13" >1.00</td>
      <td id="T_48f33_row1_col14" class="data row1 col14" >1.00</td>
      <td id="T_48f33_row1_col15" class="data row1 col15" >1.00</td>
    </tr>
    <tr>
      <th id="T_48f33_level0_row2" class="row_heading level0 row2" >prior: 0.5</th>
      <td id="T_48f33_row2_col0" class="data row2 col0" >0.91</td>
      <td id="T_48f33_row2_col1" class="data row2 col1" >0.91</td>
      <td id="T_48f33_row2_col2" class="data row2 col2" >0.18</td>
      <td id="T_48f33_row2_col3" class="data row2 col3" >0.99</td>
      <td id="T_48f33_row2_col4" class="data row2 col4" >0.99</td>
      <td id="T_48f33_row2_col5" class="data row2 col5" >0.91</td>
      <td id="T_48f33_row2_col6" class="data row2 col6" >0.99</td>
      <td id="T_48f33_row2_col7" class="data row2 col7" >0.91</td>
      <td id="T_48f33_row2_col8" class="data row2 col8" >0.99</td>
      <td id="T_48f33_row2_col9" class="data row2 col9" >0.99</td>
      <td id="T_48f33_row2_col10" class="data row2 col10" >0.99</td>
      <td id="T_48f33_row2_col11" class="data row2 col11" >0.82</td>
      <td id="T_48f33_row2_col12" class="data row2 col12" >0.99</td>
      <td id="T_48f33_row2_col13" class="data row2 col13" >0.82</td>
      <td id="T_48f33_row2_col14" class="data row2 col14" >0.99</td>
      <td id="T_48f33_row2_col15" class="data row2 col15" >0.99</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_index</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">k_and_n_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">cities</span><span class="p">[</span><span class="n">city_index</span><span class="p">],</span> 
    <span class="s2">&quot;current_survey_results&quot;</span><span class="p">:</span> <span class="n">c_results</span> <span class="p">,</span>
    <span class="s2">&quot;land_use_data&quot;</span><span class="p">:</span> <span class="n">p_ludata</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span> 
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;prior_results&quot;</span><span class="p">:</span> <span class="n">p_results</span><span class="p">,</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">uses</span><span class="p">,</span> 
    <span class="s2">&quot;unopinionated&quot;</span><span class="p">:</span> <span class="n">up</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">citykandps</span> <span class="o">=</span> <span class="n">ProbabilityForACity</span><span class="p">(</span><span class="o">**</span><span class="n">k_and_n_args</span><span class="p">)</span>

<span class="n">citypkandns</span> <span class="o">=</span> <span class="n">ProbabilityOfX</span><span class="p">(</span><span class="n">current_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">current_magnitudes</span><span class="p">,</span> <span class="n">prior_results</span><span class="o">=</span><span class="n">citykandps</span><span class="o">.</span><span class="n">prior_magnitudes</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

<span class="n">landp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">current_probability_of_x</span><span class="p">,</span>
    <span class="s2">&quot;prior_probabilities&quot;</span><span class="p">:</span> <span class="n">citypkandns</span><span class="o">.</span><span class="n">prior_probability_of_x</span>
<span class="p">}</span>

<span class="n">likelihood_and_priors</span> <span class="o">=</span> <span class="n">LikelihoodAndPriors</span><span class="p">(</span><span class="o">**</span><span class="n">landp_args</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;likelihood&quot;</span><span class="p">:</span><span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">likelihoods</span><span class="p">,</span>
    <span class="s2">&quot;prior_similar_locations&quot;</span><span class="p">:</span> <span class="n">likelihood_and_priors</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
    <span class="s2">&quot;unopinionated_prior&quot;</span><span class="p">:</span> <span class="n">uninformative4city</span><span class="p">,</span>
    <span class="s2">&quot;codes_of_interest&quot;</span><span class="p">:</span> <span class="n">cois</span><span class="p">,</span>
    <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">tholds_r</span><span class="p">,</span>
    <span class="s2">&quot;time_prior&quot;</span><span class="p">:</span> <span class="n">year_two_city_spc</span><span class="o">.</span><span class="n">uninformed_prior</span><span class="p">,</span>
    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table 13: Probability of exceeding threshold at Saint Sulpice under different priors&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">year_three_city_sp</span><span class="o">=</span> <span class="n">PForAGroupOfCodes</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="n">year_three_city_sp</span><span class="o">.</span><span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;prior: informed&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: year two posterior&quot;</span><span class="p">,</span> <span class="s2">&quot;prior: 0.5&quot;</span><span class="p">]</span>
<span class="n">year_three_city_sp</span><span class="o">.</span><span class="n">combined_results</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_abf25 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_abf25 tr:nth-child(odd) {
  background: #FFF;
}
#T_abf25 tr {
  font-size: 12px;
}
#T_abf25 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
#T_abf25 caption {
  font-size: 14px;
  font-style: italic;
  caption-side: bottom;
  text-align: left;
  margin-top: 10px;
}
#T_abf25_row0_col0, #T_abf25_row0_col8, #T_abf25_row0_col12, #T_abf25_row1_col8, #T_abf25_row1_col12, #T_abf25_row2_col0, #T_abf25_row2_col1, #T_abf25_row2_col4, #T_abf25_row2_col5, #T_abf25_row2_col8, #T_abf25_row2_col11, #T_abf25_row2_col12 {
  background-color: #840026;
  color: #f1f1f1;
}
#T_abf25_row0_col1, #T_abf25_row0_col4, #T_abf25_row0_col5, #T_abf25_row0_col11 {
  background-color: #820026;
  color: #f1f1f1;
}
#T_abf25_row0_col2 {
  background-color: #b60026;
  color: #f1f1f1;
}
#T_abf25_row0_col3, #T_abf25_row0_col6 {
  background-color: #bd0026;
  color: #f1f1f1;
}
#T_abf25_row0_col7 {
  background-color: #c40524;
  color: #f1f1f1;
}
#T_abf25_row0_col9 {
  background-color: #ee3122;
  color: #f1f1f1;
}
#T_abf25_row0_col10 {
  background-color: #d6111f;
  color: #f1f1f1;
}
#T_abf25_row0_col13 {
  background-color: #fd933f;
  color: #000000;
}
#T_abf25_row0_col14 {
  background-color: #c90823;
  color: #f1f1f1;
}
#T_abf25_row0_col15 {
  background-color: #fd7034;
  color: #f1f1f1;
}
#T_abf25_row1_col0 {
  background-color: #fd8e3c;
  color: #f1f1f1;
}
#T_abf25_row1_col1, #T_abf25_row1_col2, #T_abf25_row1_col4, #T_abf25_row1_col5, #T_abf25_row1_col10, #T_abf25_row1_col11 {
  background-color: #800026;
  color: #f1f1f1;
}
#T_abf25_row1_col3 {
  background-color: #fffac0;
  color: #000000;
}
#T_abf25_row1_col6, #T_abf25_row1_col7, #T_abf25_row1_col14, #T_abf25_row2_col2, #T_abf25_row2_col3, #T_abf25_row2_col6, #T_abf25_row2_col7, #T_abf25_row2_col10, #T_abf25_row2_col14 {
  background-color: #d41020;
  color: #f1f1f1;
}
#T_abf25_row1_col9, #T_abf25_row1_col15, #T_abf25_row2_col9, #T_abf25_row2_col15 {
  background-color: #fc5b2e;
  color: #f1f1f1;
}
#T_abf25_row1_col13 {
  background-color: #860026;
  color: #f1f1f1;
}
#T_abf25_row2_col13 {
  background-color: #feab49;
  color: #000000;
}
</style>
<table id="T_abf25">
  <caption>Table 13: Probability of exceeding threshold at Saint Sulpice under different priors</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_abf25_level0_col0" class="col_heading level0 col0" >Gfrags</th>
      <th id="T_abf25_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_abf25_level0_col2" class="col_heading level0 col2" >G27</th>
      <th id="T_abf25_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_abf25_level0_col4" class="col_heading level0 col4" >G95</th>
      <th id="T_abf25_level0_col5" class="col_heading level0 col5" >Gcaps</th>
      <th id="T_abf25_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_abf25_level0_col7" class="col_heading level0 col7" >G35</th>
      <th id="T_abf25_level0_col8" class="col_heading level0 col8" >G89</th>
      <th id="T_abf25_level0_col9" class="col_heading level0 col9" >G31</th>
      <th id="T_abf25_level0_col10" class="col_heading level0 col10" >G32</th>
      <th id="T_abf25_level0_col11" class="col_heading level0 col11" >G100</th>
      <th id="T_abf25_level0_col12" class="col_heading level0 col12" >G33</th>
      <th id="T_abf25_level0_col13" class="col_heading level0 col13" >G25</th>
      <th id="T_abf25_level0_col14" class="col_heading level0 col14" >G70</th>
      <th id="T_abf25_level0_col15" class="col_heading level0 col15" >G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_abf25_level0_row0" class="row_heading level0 row0" >prior: informed</th>
      <td id="T_abf25_row0_col0" class="data row0 col0" >0.99</td>
      <td id="T_abf25_row0_col1" class="data row0 col1" >1.00</td>
      <td id="T_abf25_row0_col2" class="data row0 col2" >0.89</td>
      <td id="T_abf25_row0_col3" class="data row0 col3" >0.87</td>
      <td id="T_abf25_row0_col4" class="data row0 col4" >0.99</td>
      <td id="T_abf25_row0_col5" class="data row0 col5" >0.99</td>
      <td id="T_abf25_row0_col6" class="data row0 col6" >0.87</td>
      <td id="T_abf25_row0_col7" class="data row0 col7" >0.85</td>
      <td id="T_abf25_row0_col8" class="data row0 col8" >0.99</td>
      <td id="T_abf25_row0_col9" class="data row0 col9" >0.69</td>
      <td id="T_abf25_row0_col10" class="data row0 col10" >0.79</td>
      <td id="T_abf25_row0_col11" class="data row0 col11" >0.99</td>
      <td id="T_abf25_row0_col12" class="data row0 col12" >0.99</td>
      <td id="T_abf25_row0_col13" class="data row0 col13" >0.48</td>
      <td id="T_abf25_row0_col14" class="data row0 col14" >0.83</td>
      <td id="T_abf25_row0_col15" class="data row0 col15" >0.56</td>
    </tr>
    <tr>
      <th id="T_abf25_level0_row1" class="row_heading level0 row1" >prior: year two posterior</th>
      <td id="T_abf25_row1_col0" class="data row1 col0" >0.50</td>
      <td id="T_abf25_row1_col1" class="data row1 col1" >1.00</td>
      <td id="T_abf25_row1_col2" class="data row1 col2" >1.00</td>
      <td id="T_abf25_row1_col3" class="data row1 col3" >0.04</td>
      <td id="T_abf25_row1_col4" class="data row1 col4" >1.00</td>
      <td id="T_abf25_row1_col5" class="data row1 col5" >1.00</td>
      <td id="T_abf25_row1_col6" class="data row1 col6" >0.80</td>
      <td id="T_abf25_row1_col7" class="data row1 col7" >0.80</td>
      <td id="T_abf25_row1_col8" class="data row1 col8" >0.99</td>
      <td id="T_abf25_row1_col9" class="data row1 col9" >0.60</td>
      <td id="T_abf25_row1_col10" class="data row1 col10" >1.00</td>
      <td id="T_abf25_row1_col11" class="data row1 col11" >1.00</td>
      <td id="T_abf25_row1_col12" class="data row1 col12" >0.99</td>
      <td id="T_abf25_row1_col13" class="data row1 col13" >0.99</td>
      <td id="T_abf25_row1_col14" class="data row1 col14" >0.80</td>
      <td id="T_abf25_row1_col15" class="data row1 col15" >0.60</td>
    </tr>
    <tr>
      <th id="T_abf25_level0_row2" class="row_heading level0 row2" >prior: 0.5</th>
      <td id="T_abf25_row2_col0" class="data row2 col0" >0.99</td>
      <td id="T_abf25_row2_col1" class="data row2 col1" >0.99</td>
      <td id="T_abf25_row2_col2" class="data row2 col2" >0.80</td>
      <td id="T_abf25_row2_col3" class="data row2 col3" >0.80</td>
      <td id="T_abf25_row2_col4" class="data row2 col4" >0.99</td>
      <td id="T_abf25_row2_col5" class="data row2 col5" >0.99</td>
      <td id="T_abf25_row2_col6" class="data row2 col6" >0.80</td>
      <td id="T_abf25_row2_col7" class="data row2 col7" >0.80</td>
      <td id="T_abf25_row2_col8" class="data row2 col8" >0.99</td>
      <td id="T_abf25_row2_col9" class="data row2 col9" >0.60</td>
      <td id="T_abf25_row2_col10" class="data row2 col10" >0.80</td>
      <td id="T_abf25_row2_col11" class="data row2 col11" >0.99</td>
      <td id="T_abf25_row2_col12" class="data row2 col12" >0.99</td>
      <td id="T_abf25_row2_col13" class="data row2 col13" >0.40</td>
      <td id="T_abf25_row2_col14" class="data row2 col14" >0.80</td>
      <td id="T_abf25_row2_col15" class="data row2 col15" >0.60</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="samples-after-may-2021">
<h2><span class="section-number">2.6. </span>Samples after May 2021<a class="headerlink" href="#samples-after-may-2021" title="Permalink to this headline">#</a></h2>
<div class="section" id="expected-results-for-saint-sulpice">
<h3><span class="section-number">2.6.1. </span>Expected results for Saint Sulpice<a class="headerlink" href="#expected-results-for-saint-sulpice" title="Permalink to this headline">#</a></h3>
<p><strong>Observed results October 2021: SWE</strong></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>code</th>
      <th>Gfrags</th>
      <th>G30</th>
      <th>G27</th>
      <th>Gfoam</th>
      <th>G95</th>
      <th>Gcaps</th>
      <th>G67</th>
      <th>G35</th>
      <th>G89</th>
      <th>G31</th>
      <th>G32</th>
      <th>G100</th>
      <th>G33</th>
      <th>G25</th>
      <th>G70</th>
      <th>G10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.53</td>
      <td>0.35</td>
      <td>0.07</td>
      <td>0.0</td>
      <td>0.17</td>
      <td>0.15</td>
      <td>0.12</td>
      <td>0.0</td>
      <td>0.17</td>
      <td>0.1</td>
      <td>0.03</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.03</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-lake">
<h4><span class="section-number">2.6.1.1. </span>The probability of the observed results at Saint Sulpice given the informed posterior from lake<a class="headerlink" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-lake" title="Permalink to this headline">#</a></h4>
<p>The observed results +/- .1. See table 12 for probability of the event at the lake.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did the observed results fall within the predicted range?
In range: 12, out of: 16

Estmiated high: 4, Estimated low: 0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-saint-sulpice">
<h4><span class="section-number">2.6.1.2. </span>The probability of the observed results at Saint Sulpice given the informed posterior from Saint Sulpice<a class="headerlink" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-saint-sulpice" title="Permalink to this headline">#</a></h4>
<p>The observed results +/- .1. See table 14 for the probability of the event at Saint Sulpice.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did the observed results fall within the predicted range?
In range: 11, out of: 16 or 0.69

Estmiated high: 5, Estimated low: 0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="plastock">
<h3><span class="section-number">2.6.2. </span>Plastock<a class="headerlink" href="#plastock" title="Permalink to this headline">#</a></h3>
<p>100 samples from 2022 on lac leman</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did the observed results fall within the predicted range?
96% probability range = (&#39;Gfrags&#39;, 0.12, 2.27)
In range: 20, out of: 25 or 0.8

Estmiated high: 1, Estimated low: 4
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/d9e3de1314e73e5b5b1d5a88c0ad9b5877b6c72060672c17444cb19911632dda.png" src="_images/d9e3de1314e73e5b5b1d5a88c0ad9b5877b6c72060672c17444cb19911632dda.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did the observed results fall within the predicted range?
96% probability range = (&#39;G27&#39;, 0.08, 2.06)
In range: 19, out of: 25 or 0.76

Estmiated high: 5, Estimated low: 1
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/53f5ea95dc7693ce983361bda15498f96dce6901cfb99781183353e5af5d2563.png" src="_images/53f5ea95dc7693ce983361bda15498f96dce6901cfb99781183353e5af5d2563.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did the observed results fall within the predicted range?
96% probability range = (&#39;G95&#39;, 0.01, 0.8)
In range: 17, out of: 25 or 0.68

Estmiated high: 8, Estimated low: 0
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/fab48de1960a1e2d31ef5ad611f27b6764f5942c73d4a50fc64f101fb23d7127.png" src="_images/fab48de1960a1e2d31ef5ad611f27b6764f5942c73d4a50fc64f101fb23d7127.png" />
</div>
</div>
<div class="section" id="expected-values-and-predictions-plastock">
<h4><span class="section-number">2.6.2.1. </span>Expected values and predictions plastock<a class="headerlink" href="#expected-values-and-predictions-plastock" title="Permalink to this headline">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plastock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/pstock_2022.csv&quot;</span><span class="p">)</span>
<span class="n">plastock</span><span class="p">[</span><span class="s2">&quot;loc_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">plastock</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">plastock</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
<span class="n">pstock</span> <span class="o">=</span> <span class="n">plastock</span><span class="p">[</span><span class="n">plastock</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cois</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">pstock</span> <span class="o">=</span> <span class="n">pstock</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;loc_date&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;pcs/m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pstock</span> <span class="o">=</span> <span class="n">pstock</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;pcs/m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">a_p_for_index</span> <span class="o">=</span> <span class="n">year_three</span><span class="o">.</span><span class="n">informed_prior</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mf">.03</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="mf">.97</span><span class="p">)]</span><span class="o">.</span><span class="n">mag</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_p_for_index</span><span class="p">)]</span>
<span class="n">tr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">cois</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">2</span><span class="p">),</span>  <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>

<span class="n">pst</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pstock</span><span class="p">[</span><span class="n">pstock</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">x</span><span class="p">][</span><span class="s2">&quot;pcs/m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cois</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">inn</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ress</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pst</span><span class="p">):</span>
    <span class="n">tested</span> <span class="o">=</span> <span class="p">[</span><span class="n">is_in_range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">tr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="c1"># print(&quot;\nDid the observed results fall within the predicted range?&quot;)</span>
    <span class="n">in_range</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tested</span><span class="p">])</span>
    <span class="n">arange</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tested</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="n">arange</span>
    <span class="n">inn</span> <span class="o">+=</span> <span class="n">in_range</span>
    <span class="n">highs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tested</span><span class="p">])</span>
    <span class="n">lows</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tested</span><span class="p">])</span>
    <span class="n">arow</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="n">tr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;rlow&quot;</span><span class="p">:</span><span class="n">tr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rhigh&quot;</span><span class="p">:</span><span class="n">tr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;o-mean&quot;</span><span class="p">:</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;in range&quot;</span><span class="p">:</span><span class="n">in_range</span><span class="p">,</span> <span class="s2">&quot;plow&quot;</span><span class="p">:</span><span class="n">lows</span><span class="p">,</span> <span class="s2">&quot;phigh&quot;</span><span class="p">:</span><span class="n">highs</span><span class="p">}</span>
    <span class="n">ress</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arow</span><span class="p">)</span>
    <span class="c1"># print(f&quot;96% probability range = {tr[i]}&quot;)</span>
    <span class="c1"># print(f&quot;In range: {in_range}, out of: {arange} or {round(in_range/arange, 2)}\n&quot;)</span>
    <span class="c1"># print(f&quot;Estmiated high: {highs}, Estimated low: {lows}&quot;)</span>
    <span class="c1"># print(n, inn)</span>

<span class="n">rest</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ress</span><span class="p">)</span>
<span class="n">rest</span><span class="p">[</span><span class="s2">&quot;o mean in range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rest</span><span class="p">[</span><span class="s2">&quot;o-mean&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rest</span><span class="o">.</span><span class="n">rlow</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rest</span><span class="p">[</span><span class="s2">&quot;o-mean&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rest</span><span class="o">.</span><span class="n">rhigh</span><span class="p">)</span>
<span class="n">rest</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">code_d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">rest</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>
<span class="n">rest</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rest</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>object</th>
      <th>rlow</th>
      <th>rhigh</th>
      <th>o-mean</th>
      <th>in range</th>
      <th>plow</th>
      <th>phigh</th>
      <th>o mean in range</th>
    </tr>
    <tr>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Gfrags</th>
      <td>Fragmented plastics</td>
      <td>0.12</td>
      <td>2.27</td>
      <td>1.41</td>
      <td>20</td>
      <td>4</td>
      <td>1</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G30</th>
      <td>Food wrappers; candy, snacks</td>
      <td>0.07</td>
      <td>0.89</td>
      <td>0.28</td>
      <td>16</td>
      <td>1</td>
      <td>8</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G27</th>
      <td>Cigarette filters</td>
      <td>0.08</td>
      <td>2.06</td>
      <td>0.43</td>
      <td>20</td>
      <td>1</td>
      <td>4</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Gfoam</th>
      <td>Expanded polystyrene</td>
      <td>0.02</td>
      <td>2.17</td>
      <td>0.21</td>
      <td>21</td>
      <td>0</td>
      <td>4</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G95</th>
      <td>Cotton bud/swab sticks</td>
      <td>0.01</td>
      <td>0.80</td>
      <td>0.15</td>
      <td>18</td>
      <td>0</td>
      <td>7</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Gcaps</th>
      <td>Plastic bottle lids</td>
      <td>0.03</td>
      <td>0.63</td>
      <td>0.14</td>
      <td>17</td>
      <td>1</td>
      <td>7</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G67</th>
      <td>Industrial sheeting</td>
      <td>0.01</td>
      <td>0.56</td>
      <td>0.02</td>
      <td>4</td>
      <td>0</td>
      <td>21</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G35</th>
      <td>Straws and stirrers</td>
      <td>0.01</td>
      <td>0.17</td>
      <td>0.02</td>
      <td>16</td>
      <td>0</td>
      <td>9</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G89</th>
      <td>Plastic construction waste</td>
      <td>0.01</td>
      <td>0.29</td>
      <td>0.05</td>
      <td>12</td>
      <td>2</td>
      <td>11</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G31</th>
      <td>Lollypop sticks</td>
      <td>0.01</td>
      <td>0.17</td>
      <td>0.05</td>
      <td>17</td>
      <td>2</td>
      <td>6</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G32</th>
      <td>Toys and party favors</td>
      <td>0.01</td>
      <td>0.12</td>
      <td>0.01</td>
      <td>8</td>
      <td>0</td>
      <td>17</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G100</th>
      <td>Medical; containers/tubes/ packaging</td>
      <td>0.01</td>
      <td>0.14</td>
      <td>0.00</td>
      <td>4</td>
      <td>0</td>
      <td>21</td>
      <td>False</td>
    </tr>
    <tr>
      <th>G33</th>
      <td>Cups, lids, single use foamed and hard plastic</td>
      <td>0.01</td>
      <td>0.11</td>
      <td>0.01</td>
      <td>5</td>
      <td>0</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G25</th>
      <td>Tobacco; plastic packaging, containers</td>
      <td>0.01</td>
      <td>0.15</td>
      <td>0.00</td>
      <td>2</td>
      <td>0</td>
      <td>23</td>
      <td>False</td>
    </tr>
    <tr>
      <th>G70</th>
      <td>Shotgun cartridges</td>
      <td>0.01</td>
      <td>0.18</td>
      <td>0.02</td>
      <td>13</td>
      <td>0</td>
      <td>12</td>
      <td>True</td>
    </tr>
    <tr>
      <th>G10</th>
      <td>Food containers single use foamed or plastic</td>
      <td>0.01</td>
      <td>0.10</td>
      <td>0.00</td>
      <td>3</td>
      <td>0</td>
      <td>22</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="mix-of-objects-of-total">
<h4><span class="section-number">2.6.2.2. </span>Mix of objects, % of total<a class="headerlink" href="#mix-of-objects-of-total" title="Permalink to this headline">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># coi % of total</span>
<span class="n">code_totals</span> <span class="o">=</span> <span class="n">plastock</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">code_totals</span><span class="p">[</span><span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_totals</span><span class="o">.</span><span class="n">quantity</span><span class="o">/</span><span class="n">code_totals</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">ct_i</span> <span class="o">=</span> <span class="n">code_totals</span><span class="p">[</span><span class="n">code_totals</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cois</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">lake_ythree</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">date_mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">water_name_slug</span> <span class="o">==</span> <span class="s1">&#39;lac-leman&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">lake_y3</span> <span class="o">=</span> <span class="n">lake_ythree</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">lake_y3</span><span class="p">[</span><span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lake_y3</span><span class="o">.</span><span class="n">quantity</span><span class="o">/</span><span class="n">lake_y3</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">lake_y3i</span> <span class="o">=</span> <span class="n">lake_y3</span><span class="p">[</span><span class="n">lake_y3</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cois</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">l_a_mx</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">all_data</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;plage-de-st-sulpice&#39;</span><span class="p">,</span> <span class="s1">&#39;tiger_duck_beach&#39;</span><span class="p">])]</span>
<span class="n">sp_x</span> <span class="o">=</span> <span class="n">l_a_mx</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sp_x</span><span class="p">[</span><span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp_x</span><span class="o">.</span><span class="n">quantity</span><span class="o">/</span><span class="n">sp_x</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sp_xi</span> <span class="o">=</span> <span class="n">sp_x</span><span class="p">[</span><span class="n">sp_x</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cois</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sp_xi</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;%&quot;</span><span class="p">:</span><span class="s2">&quot;SWE %&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sp_xi</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="n">code_totals</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;%&quot;</span><span class="p">:</span><span class="s2">&quot;plastock %&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lake_y3</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;%&quot;</span><span class="p">:</span><span class="s2">&quot;lake %&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">res_pct</span> <span class="o">=</span> <span class="n">code_totals</span><span class="p">[[</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;plastock %&quot;</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lake_y3</span><span class="p">[[</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;lake %&quot;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
<span class="n">res_pct</span> <span class="o">=</span> <span class="n">res_pct</span><span class="p">[</span><span class="n">res_pct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cois</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;plastock %&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">res_pct</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_pct</span> <span class="o">=</span> <span class="n">res_pct</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sp_xi</span><span class="p">[</span><span class="s2">&quot;SWE %&quot;</span><span class="p">],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_pct</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>plastock %</th>
      <th>lake %</th>
      <th>SWE %</th>
    </tr>
    <tr>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Gfrags</th>
      <td>40.16</td>
      <td>15.29</td>
      <td>15.74</td>
    </tr>
    <tr>
      <th>G27</th>
      <td>11.67</td>
      <td>11.27</td>
      <td>10.10</td>
    </tr>
    <tr>
      <th>G30</th>
      <td>7.35</td>
      <td>6.09</td>
      <td>8.60</td>
    </tr>
    <tr>
      <th>Gfoam</th>
      <td>4.97</td>
      <td>13.13</td>
      <td>4.17</td>
    </tr>
    <tr>
      <th>Gcaps</th>
      <td>3.88</td>
      <td>3.80</td>
      <td>2.58</td>
    </tr>
    <tr>
      <th>G95</th>
      <td>3.67</td>
      <td>4.07</td>
      <td>7.60</td>
    </tr>
    <tr>
      <th>G89</th>
      <td>1.48</td>
      <td>2.14</td>
      <td>1.73</td>
    </tr>
    <tr>
      <th>G31</th>
      <td>1.33</td>
      <td>0.87</td>
      <td>0.79</td>
    </tr>
    <tr>
      <th>G70</th>
      <td>0.70</td>
      <td>1.27</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>G35</th>
      <td>0.56</td>
      <td>1.02</td>
      <td>0.59</td>
    </tr>
    <tr>
      <th>G67</th>
      <td>0.52</td>
      <td>3.90</td>
      <td>2.06</td>
    </tr>
    <tr>
      <th>G32</th>
      <td>0.23</td>
      <td>0.70</td>
      <td>0.94</td>
    </tr>
    <tr>
      <th>G33</th>
      <td>0.15</td>
      <td>0.72</td>
      <td>0.21</td>
    </tr>
    <tr>
      <th>G10</th>
      <td>0.06</td>
      <td>1.05</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>G100</th>
      <td>0.05</td>
      <td>0.64</td>
      <td>1.79</td>
    </tr>
    <tr>
      <th>G25</th>
      <td>0.02</td>
      <td>1.07</td>
      <td>0.47</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Percent of all identified objects concerned by these results</strong></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plastock %    0.767988
lake %        0.670193
SWE %         0.582501
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p>This script updated 07/07/2023 in Biel, CH</p>
<blockquote>
<div><p>❤️ what you do everyday</p>
</div></blockquote>
<p><em>analyst at hammerdirt</em></p>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Git repo: https://github.com/hammerdirt-analyst/patelmanuscript.git

Git branch: newsummary

matplotlib: 3.7.1
numpy     : 1.24.3
seaborn   : 0.12.2
pandas    : 2.0.2
scipy     : 1.10.1
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="summary_2015_2021.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Monitoring beach litter with future engineers</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#research-questions">2.1. Research questions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-applications">2.1.1. Practical applications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-and-definitions">2.2. Methods and definitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#threshold">2.2.1. threshold</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency">2.2.2. frequency</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#land-use">2.2.3. land-use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#probability">2.2.4. probability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-tables">2.2.5. Inference tables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#local-environmental-conditions">2.2.6. local environmental conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-landuse-attributes">2.2.6.1. distribution of landuse attributes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-of-land-use-attributes">2.2.6.2. correlation of land use attributes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#codes-of-interest">2.2.7. Codes of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-one-november-2015-november-2016">2.3. Sampling period one: November 2015 - November 2016</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chance-of-exceeding-threshold-lake">2.3.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chance-of-exceeding-threshold-city">2.3.2. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-two-april-2017-may-2018">2.4. Sampling period two: April 2017 - May 2018</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.4.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.4.2. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-period-three-april-2020-may-2021">2.5. Sampling period three: April 2020 - May 2021</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.5.1. Chance of exceeding threshold: lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.5.2. Chance of exceeding threshold: city</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.5.3. Chance of exceeding threshold: city</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-after-may-2021">2.6. Samples after May 2021</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results-for-saint-sulpice">2.6.1. Expected results for Saint Sulpice</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-lake">2.6.1.1. The probability of the observed results at Saint Sulpice given the informed posterior from lake</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-the-observed-results-at-saint-sulpice-given-the-informed-posterior-from-saint-sulpice">2.6.1.2. The probability of the observed results at Saint Sulpice given the informed posterior from Saint Sulpice</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plastock">2.6.2. Plastock</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-values-and-predictions-plastock">2.6.2.1. Expected values and predictions plastock</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mix-of-objects-of-total">2.6.2.2. Mix of objects, % of total</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By All
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
   hammerdirt 2023
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>